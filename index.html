<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANSFAL - جمعية التعاون والتنمية والبيئة</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ==================== VARIABLES ET RESET ==================== */
        :root {
            --primary: #1a6d2c;
            --secondary: #2e8b57;
            --accent: #3cb371;
            --light: #f0f9f3;
            --dark: #145a32;
            --text: #333333;
            --white: #ffffff;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --admin: #ff9800;
            --webmaster: #9c27b0;
            --whatsapp: #25D366;
            --warning: #ff9800;
            --success: #4caf50;
            --danger: #f44336;
            --info: #2196F3;
            --dashboard-bg: #f5f5f5;
            --card-bg: #ffffff;
            --sidebar-bg: #2c3e50;
            --sidebar-text: #ecf0f1;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', 'Cairo', sans-serif;
            line-height: 1.6;
            color: var(--text);
            background-color: var(--white);
            transition: all 0.3s ease;
        }

        h1, h2, h3, h4 {
            font-family: 'Poppins', 'Cairo', sans-serif;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 1rem;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* ==================== COMPTEUR VISITEURS ==================== */
        .visitor-counter {
            background-color: var(--info);
            color: white;
            padding: 8px 0;
            font-size: 0.85rem;
            text-align: center;
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .visitor-counter .container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .visitor-count {
            font-weight: bold;
            background: rgba(255,255,255,0.2);
            padding: 2px 10px;
            border-radius: 10px;
            font-size: 0.9rem;
        }

        /* ==================== LANGUAGE SWITCHER ==================== */
        .language-switcher {
            position: fixed;
            top: 45px;
            right: 15px;
            z-index: 1001;
            display: flex;
            gap: 5px;
        }

        .lang-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 5px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .lang-btn.active {
            background-color: var(--dark);
        }

        .lang-btn:hover {
            background-color: var(--secondary);
        }

        /* ==================== BARRE D'AUTHENTIFICATION ==================== */
        .auth-bar {
            position: fixed;
            top: 40px;
            left: 0;
            width: 100%;
            background: linear-gradient(135deg, var(--sidebar-bg), #4a6491);
            color: var(--sidebar-text);
            padding: 12px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 999;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .auth-form {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .auth-form input {
            padding: 8px 15px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 4px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 14px;
        }

        .auth-form input::placeholder {
            color: rgba(255,255,255,0.7);
        }

        .auth-form button {
            background: var(--success);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }

        .auth-form button:hover {
            background: #219653;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-name {
            font-weight: bold;
            color: var(--sidebar-text);
        }

        .user-role {
            background: var(--primary);
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 12px;
        }

        .logout-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }

        .logout-btn:hover {
            background: #c0392b;
        }

        .hidden {
            display: none !important;
        }

        /* ==================== HEADER HORIZONTAL ==================== */
        header {
            background-color: var(--white);
            box-shadow: var(--shadow);
            position: fixed;
            width: 100%;
            top: 95px;
            z-index: 998;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
        }

        .logo i {
            font-size: 2rem;
            color: var(--primary);
        }

        .logo-text h1 {
            font-size: 1.5rem;
            margin-bottom: 0;
            color: var(--primary);
        }

        .logo-text p {
            font-size: 0.8rem;
            color: var(--secondary);
            margin-top: -5px;
        }

        .logo-edit-btn {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--admin);
            color: white;
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .admin-mode .logo-edit-btn {
            display: flex;
        }

        .logo-edit-btn:hover {
            background: #e68900;
            transform: scale(1.1);
        }

        /* ==================== MENU HORIZONTAL ==================== */
        nav ul {
            display: flex;
            list-style: none;
            gap: 25px;
        }

        nav a {
            text-decoration: none;
            color: var(--text);
            font-weight: 500;
            transition: color 0.3s;
            padding: 5px 0;
            position: relative;
        }

        nav a:hover {
            color: var(--primary);
        }

        nav a.active {
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
        }

        nav a:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--primary);
            transition: width 0.3s;
        }

        nav a:hover:after {
            width: 100%;
        }

        /* ==================== DASHBOARD SIMPLIFIÉ ==================== */
        .dashboard-simple {
            display: none;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 140px 20px 20px;
        }

        /* Masquer le dashboard simplifié si non connecté */
        body:not(.admin-mode) .dashboard-simple {
            display: none !important;
        }

        .simple-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .simple-header {
            background: linear-gradient(135deg, var(--primary), var(--dark));
            color: white;
            padding: 30px;
            text-align: center;
        }

        .simple-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: white;
        }

        .simple-header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .simple-dashboard {
            padding: 30px;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .dashboard-title {
            font-size: 2rem;
            color: var(--dark);
        }

        .btn-import {
            background: var(--success);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }

        .btn-import:hover {
            background: #219653;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(33, 150, 83, 0.3);
        }

        /* ==================== GRID SECTIONS ==================== */
        .sections-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .section-card {
            background: var(--light);
            border-radius: 15px;
            padding: 30px;
            transition: all 0.3s;
            border: 3px solid transparent;
            position: relative;
            min-height: 250px;
            display: flex;
            flex-direction: column;
        }

        .section-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
            box-shadow: 0 15px 30px rgba(60, 179, 113, 0.2);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.5rem;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-icon {
            width: 50px;
            height: 50px;
            background: var(--primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        /* ==================== BOUTONS AJOUT ==================== */
        .btn-add-large {
            background: linear-gradient(135deg, var(--accent), var(--secondary));
            color: white;
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            font-size: 28px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 20px rgba(60, 179, 113, 0.4);
            position: absolute;
            bottom: 30px;
            right: 30px;
        }

        .btn-add-large:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 10px 25px rgba(60, 179, 113, 0.6);
        }

        .btn-quick-add {
            background: var(--info);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-quick-add:hover {
            background: #1976d2;
            transform: translateY(-2px);
        }

        /* ==================== CONTENU PRÉVISUALISATION ==================== */
        .section-content {
            flex-grow: 1;
            overflow-y: auto;
            max-height: 150px;
            margin-bottom: 20px;
        }

        .content-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .preview-item {
            background: white;
            border-radius: 8px;
            padding: 10px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .preview-item:hover {
            background: var(--light);
            transform: translateY(-2px);
        }

        .preview-item i {
            color: var(--primary);
        }

        .no-content {
            color: #666;
            font-style: italic;
            text-align: center;
            padding: 20px;
            background: rgba(255,255,255,0.5);
            border-radius: 10px;
            margin-top: 10px;
        }

        /* ==================== MODALES ==================== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 20px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary), var(--dark));
            color: white;
            padding: 25px;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.3s;
        }

        .close-modal:hover {
            background: rgba(255,255,255,0.2);
        }

        .modal-body {
            padding: 30px;
        }

        /* ==================== CHOIX UPLOAD/URL ==================== */
        .upload-choice {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        .choice-btn {
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .choice-btn:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .choice-btn.active {
            border-color: var(--primary);
            background: var(--light);
        }

        .choice-btn i {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 10px;
            display: block;
        }

        /* ==================== UPLOAD AREA ==================== */
        .upload-area {
            border: 3px dashed #ddd;
            border-radius: 15px;
            padding: 50px 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 30px;
            background: var(--light);
        }

        .upload-area:hover {
            border-color: var(--accent);
            background: rgba(60, 179, 113, 0.05);
        }

        .upload-area.drag-over {
            border-color: var(--success);
            background: rgba(76, 175, 80, 0.1);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 4rem;
            color: var(--primary);
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 1.2rem;
            color: var(--text);
            margin-bottom: 10px;
        }

        .upload-subtext {
            color: #666;
            margin-bottom: 20px;
        }

        .btn-browse {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }

        .btn-browse:hover {
            background: var(--dark);
            transform: translateY(-2px);
        }

        .file-input {
            display: none;
        }

        /* ==================== URL INPUT AREA ==================== */
        .url-input-area {
            display: none;
            margin-bottom: 30px;
        }

        .url-input-area.active {
            display: block;
        }

        .url-input-group {
            margin-bottom: 20px;
        }

        .url-input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .url-input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }

        .url-input-group input:focus {
            border-color: var(--primary);
            outline: none;
        }

        .url-examples {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #666;
        }

        .url-examples strong {
            color: var(--dark);
        }

        /* ==================== FILE PREVIEW ==================== */
        .file-preview {
            margin-top: 30px;
        }

        .file-preview-title {
            font-size: 1.3rem;
            color: var(--dark);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .files-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
        }

        .file-item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            transition: all 0.3s;
            position: relative;
            border: 2px solid transparent;
        }

        .file-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.12);
            border-color: var(--accent);
        }

        .file-icon {
            font-size: 2.5rem;
            color: var(--primary);
            text-align: center;
            margin-bottom: 10px;
        }

        .file-name {
            font-size: 0.9rem;
            font-weight: 500;
            text-align: center;
            word-break: break-word;
            margin-bottom: 5px;
        }

        .file-size {
            font-size: 0.8rem;
            color: #666;
            text-align: center;
        }

        .remove-file {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--danger);
            color: white;
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        /* ==================== PROGRESS BAR ==================== */
        .upload-progress {
            margin-top: 30px;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 25px;
            background: #eee;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            width: 0%;
            transition: width 0.3s;
            border-radius: 12px;
        }

        .progress-text {
            text-align: center;
            font-weight: 500;
            color: var(--dark);
            margin-bottom: 15px;
        }

        /* ==================== SUCCESS MESSAGE ==================== */
        .upload-success {
            margin-top: 30px;
            text-align: center;
            display: none;
        }

        .success-icon {
            font-size: 4rem;
            color: var(--success);
            margin-bottom: 20px;
            animation: bounce 1s ease infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .success-text {
            font-size: 1.5rem;
            color: var(--success);
            margin-bottom: 20px;
        }

        .btn-ok {
            background: var(--success);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }

        .btn-ok:hover {
            background: #219653;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(33, 150, 83, 0.3);
        }

        /* ==================== FILE SIZE WARNING ==================== */
        .size-warning {
            background: var(--warning);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.8; }
            50% { opacity: 1; }
            100% { opacity: 0.8; }
        }

        /* ==================== IMPORT MODAL ==================== */
        .import-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .import-option {
            background: var(--light);
            border: 2px solid transparent;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .import-option:hover {
            border-color: var(--accent);
            transform: translateY(-5px);
            background: white;
        }

        .import-icon {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .import-title {
            font-size: 1.3rem;
            color: var(--dark);
            margin-bottom: 10px;
        }

        .import-desc {
            color: #666;
            font-size: 0.95rem;
        }

        .json-input {
            display: none;
        }

        /* ==================== FILE VIEWER MODAL ==================== */
        .file-viewer {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .file-viewer.active {
            display: flex;
        }

        .file-viewer-content {
            background: white;
            border-radius: 15px;
            max-width: 90%;
            max-height: 90%;
            overflow: hidden;
            position: relative;
        }

        .file-viewer-header {
            background: var(--dark);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-viewer-body {
            padding: 30px;
            text-align: center;
            max-height: 70vh;
            overflow-y: auto;
        }

        .file-viewer-body img, .file-viewer-body video {
            max-width: 100%;
            max-height: 60vh;
            border-radius: 10px;
        }

        .file-viewer-body iframe {
            width: 100%;
            height: 70vh;
            border: none;
            border-radius: 10px;
        }

        .close-viewer {
            background: none;
            border: none;
            color: white;
            font-size: 1.8rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-viewer:hover {
            background: rgba(255,255,255,0.2);
        }

        /* ==================== HERO SECTION ==================== */
        .hero {
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), 
                        url('https://images.unsplash.com/photo-1542601906990-b4d3fb778b09?ixlib=rb-4.0.3&auto=format&fit=crop&w=1470&q=80');
            background-size: cover;
            background-position: center;
            color: var(--white);
            text-align: center;
            padding: 180px 0 100px;
            margin-top: 95px;
        }

        .hero h2 {
            font-size: 3rem;
            color: var(--white);
            margin-bottom: 20px;
        }

        .hero p {
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto 30px;
        }

        .btn {
            display: inline-block;
            background-color: var(--accent);
            color: var(--white);
            padding: 12px 30px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            border: 2px solid var(--accent);
        }

        .btn:hover {
            background-color: transparent;
            color: var(--accent);
        }

        /* ==================== SECTIONS ANSFAL ==================== */
        section {
            padding: 80px 0;
            display: none;
        }

        section.active {
            display: block;
        }

        .section-header {
            text-align: center;
            margin-bottom: 50px;
        }

        .section-title {
            position: relative;
            display: inline-block;
            padding-bottom: 15px;
        }

        .section-title h2 {
            font-size: 2.5rem;
        }

        .section-title h2:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 4px;
            background-color: var(--accent);
        }

        /* ==================== CONTENU AFFICHÉ ==================== */
        /* Galerie publique */
        .gallery-public {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .gallery-public-item {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow);
            aspect-ratio: 4/3;
            cursor: pointer;
        }

        .gallery-public-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }

        .gallery-public-item:hover img {
            transform: scale(1.05);
        }

        /* Vidéos publiques */
        .videos-public {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .video-public-item {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow);
            aspect-ratio: 16/9;
            cursor: pointer;
        }

        /* Publications publiques */
        .publications-public {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        /* ==================== DASHBOARD SECTION ==================== */
        .dashboard-section {
            background-color: var(--dashboard-bg);
            min-height: 100vh;
            padding-top: 95px;
        }

        .dashboard-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 30px;
            min-height: calc(100vh - 95px);
        }

        /* Sidebar */
        .dashboard-sidebar {
            background: var(--sidebar-bg);
            color: var(--sidebar-text);
            padding: 30px 0;
            border-radius: 0 10px 10px 0;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 5px;
        }

        .sidebar-menu a {
            display: block;
            padding: 15px 30px;
            color: var(--sidebar-text);
            text-decoration: none;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }

        .sidebar-menu a:hover {
            background: rgba(255,255,255,0.1);
            border-left-color: var(--accent);
        }

        .sidebar-menu a.active {
            background: rgba(255,255,255,0.15);
            border-left-color: var(--accent);
            font-weight: bold;
        }

        .sidebar-menu i {
            width: 20px;
            margin-right: 10px;
        }

        /* Dashboard Content */
        .dashboard-content {
            padding: 30px;
            background: var(--white);
            border-radius: 10px;
            box-shadow: var(--shadow);
        }

        .page-title {
            color: var(--dark);
            font-size: 28px;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--accent);
        }

        /* Statistiques */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--light);
            padding: 25px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid var(--primary);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            margin: 0 0 15px 0;
            color: var(--dark);
            font-size: 18px;
        }

        .stat-number {
            font-size: 36px;
            font-weight: bold;
            color: var(--primary);
        }

        /* Styles pour les sections du dashboard */
        .dashboard-section-content {
            padding: 20px;
            display: none;
        }

        .dashboard-section-content.active {
            display: block;
        }

        .section-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }

        .dashboard-item {
            background: var(--light);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s;
            border-left: 4px solid var(--primary);
        }

        .dashboard-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .item-icon {
            font-size: 2rem;
            color: var(--primary);
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border-radius: 10px;
        }

        .item-info {
            flex-grow: 1;
        }

        .item-info h4 {
            margin: 0 0 5px 0;
            font-size: 1rem;
            color: var(--dark);
        }

        .item-info small {
            color: #666;
            font-size: 0.85rem;
        }

        .item-actions {
            display: flex;
            gap: 8px;
        }

        .btn-action {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: none;
            background: var(--info);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .btn-action:hover {
            transform: scale(1.1);
        }

        .btn-action:nth-child(1) {
            background: var(--success);
        }

        .btn-action:nth-child(2) {
            background: var(--danger);
        }

        /* ==================== À PROPOS ==================== */
        .about-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
            align-items: center;
        }

        .about-img {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .about-img img {
            width: 100%;
            height: auto;
            display: block;
            transition: transform 0.5s;
        }

        .about-img:hover img {
            transform: scale(1.05);
        }

        /* ==================== GALERIE ==================== */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .gallery-item {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow);
            aspect-ratio: 4/3;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }

        .gallery-item:hover img {
            transform: scale(1.05);
        }

        /* ==================== VIDÉOS ==================== */
        .video-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .video-item {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow);
            aspect-ratio: 16/9;
        }

        .youtube-embed {
            position: relative;
            width: 100%;
            height: 100%;
            padding-bottom: 56.25%;
            overflow: hidden;
            background: #000;
        }

        .youtube-embed iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        /* ==================== PROJETS ==================== */
        .projects-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .project-card {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: transform 0.3s;
        }

        .project-card:hover {
            transform: translateY(-10px);
        }

        .project-img {
            height: 200px;
            overflow: hidden;
        }

        .project-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }

        .project-card:hover .project-img img {
            transform: scale(1.1);
        }

        .project-info {
            padding: 25px;
            background-color: var(--white);
        }

        /* ==================== PUBLICATIONS ==================== */
        .publications-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }

        .publication-card {
            background: var(--white);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
        }

        .publication-card:hover {
            transform: translateY(-5px);
        }

        .publication-header {
            padding: 20px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .publication-type {
            background: rgba(255, 255, 255, 0.2);
            padding: 3px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .publication-date {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        .publication-content {
            padding: 20px;
        }

        .publication-title {
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: var(--dark);
            font-weight: 600;
        }

        .publication-description {
            color: var(--text);
            font-size: 0.95rem;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        /* ==================== CONTACT ==================== */
        .contact-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .contact-item {
            text-align: center;
            padding: 20px;
            background: var(--light);
            border-radius: 10px;
            transition: transform 0.3s;
        }

        .contact-item:hover {
            transform: translateY(-5px);
        }

        .contact-item i {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 15px;
        }

        /* ==================== FOOTER ==================== */
        footer {
            background-color: var(--dark);
            color: var(--white);
            padding: 60px 0 30px;
        }

        .footer-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 40px;
        }

        .social-icons {
            display: flex;
            gap: 15px;
        }

        .social-icons a {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            color: var(--white);
            font-size: 1.2rem;
            transition: all 0.3s;
        }

        .social-icons a:hover {
            background-color: var(--accent);
            transform: translateY(-5px);
        }

        .copyright {
            text-align: center;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* ==================== BOUTONS FLOTTANTS ==================== */
        .whatsapp-float {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background-color: var(--whatsapp);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            box-shadow: 0 4px 12px rgba(37, 211, 102, 0.3);
            z-index: 1000;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
        }

        .whatsapp-float:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(37, 211, 102, 0.4);
        }

        .login-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--admin);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 1000;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        /* Masquer le bouton d'ajout si non admin */
        body:not(.admin-mode) .btn-add-float {
            display: none !important;
        }

        .btn-add-float {
            position: fixed;
            bottom: 150px;
            right: 20px;
            background: linear-gradient(135deg, var(--success), #2ecc71);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 3px 10px rgba(39, 174, 96, 0.3);
            display: none;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .admin-mode .btn-add-float {
            display: flex;
        }

        .btn-add-float:hover {
            background: linear-gradient(135deg, #219653, #27ae60);
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }

        /* ==================== ALERTES ==================== */
        .alert {
            position: fixed;
            top: 150px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 6px;
            z-index: 9999;
            max-width: 300px;
            font-weight: 500;
            animation: slideIn 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .alert.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        /* ==================== PETIT BOUTON DE SUPPRESSION ==================== */
        .remove-file-small {
            background: var(--danger);
            color: white;
            border: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.6rem;
            margin-left: 5px;
            flex-shrink: 0;
            opacity: 0.7;
            transition: all 0.3s;
        }

        .remove-file-small:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        /* ==================== RESPONSIVE ==================== */
        @media (max-width: 768px) {
            .visitor-counter .container {
                flex-direction: column;
                gap: 5px;
            }
            
            .header-container {
                flex-direction: column;
                gap: 15px;
            }
            
            nav ul {
                flex-wrap: wrap;
                justify-content: center;
                gap: 15px;
            }
            
            .hero {
                padding: 120px 0 60px;
                margin-top: 95px;
            }
            
            .hero h2 {
                font-size: 2rem;
            }
            
            .about-content {
                grid-template-columns: 1fr;
            }
            
            .footer-container {
                grid-template-columns: 1fr;
                text-align: center;
            }
            
            .whatsapp-float {
                bottom: 70px;
                right: 15px;
            }
            
            .login-btn {
                bottom: 15px;
                right: 15px;
            }
            
            .btn-add-float {
                bottom: 120px;
                right: 15px;
            }
            
            .dashboard-container {
                grid-template-columns: 1fr;
            }
            
            .dashboard-sidebar {
                border-radius: 0;
                padding: 20px 0;
            }
            
            .auth-bar {
                flex-direction: column;
                gap: 10px;
                padding: 15px;
            }
            
            .auth-form {
                flex-direction: column;
                width: 100%;
            }
            
            .auth-form input {
                width: 100%;
            }
            
            .user-info {
                flex-direction: column;
                gap: 10px;
            }
            
            .section-actions {
                flex-direction: column;
            }
            
            .items-grid {
                grid-template-columns: 1fr;
            }
            
            .upload-choice {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .visitor-counter {
                font-size: 0.75rem;
            }
            
            .language-switcher {
                top: 40px;
                right: 10px;
            }
            
            .logo-text h1 {
                font-size: 1.3rem;
            }
            
            .section-title h2 {
                font-size: 2rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-item {
                flex-direction: column;
                text-align: center;
            }
            
            .item-actions {
                justify-content: center;
            }
        }

        /* ==================== RTL SUPPORT ==================== */
        body.rtl {
            direction: rtl;
            text-align: right;
        }

        body.rtl .logo {
            flex-direction: row-reverse;
        }
        
        body.rtl nav ul {
            flex-direction: row-reverse;
        }
        
        body.rtl .language-switcher {
            right: auto;
            left: 15px;
        }
        
        body.rtl .whatsapp-float {
            right: auto;
            left: 20px;
        }
        
        body.rtl .login-btn {
            right: auto;
            left: 20px;
        }
        
        body.rtl .btn-add-float {
            right: auto;
            left: 20px;
        }
        
        body.rtl .section-title h2:after {
            left: auto;
            right: 50%;
            transform: translateX(50%);
        }
        
        body.rtl .sidebar-menu a {
            border-left: none;
            border-right: 4px solid transparent;
        }
        
        body.rtl .sidebar-menu a:hover {
            border-right-color: var(--accent);
        }
        
        body.rtl .sidebar-menu a.active {
            border-right-color: var(--accent);
        }
        
        body.rtl .stat-card {
            border-left: none;
            border-right: 4px solid var(--primary);
        }
        
        body.rtl .sidebar-menu i {
            margin-right: 0;
            margin-left: 10px;
        }
        
        body.rtl nav a:after {
            left: auto;
            right: 0;
        }
    </style>
</head>
<body>
    <!-- ==================== COMPTEUR VISITEURS ==================== -->
    <div class="visitor-counter" id="visitorCounter">
        <div class="container">
            <span id="visitorsLabel">زوار: <span class="visitor-count" id="totalVisitors">0</span></span>
            <span id="onlineLabel">متصلون: <span class="visitor-count" id="onlineVisitors">0</span></span>
            <span id="lastVisitLabel">آخر زيارة: <span id="lastVisit">--/--/---- --:--:--</span></span>
        </div>
    </div>

    <!-- ==================== BARRE D'AUTHENTIFICATION ==================== -->
    <div id="authBar" class="auth-bar">
        <div id="loginForm" class="auth-form">
            <input type="text" id="username" placeholder="اسم المستخدم">
            <input type="password" id="password" placeholder="كلمة المرور">
            <button onclick="login()">تسجيل الدخول</button>
        </div>
        <div id="userInfo" class="user-info hidden">
            <div>
                <span id="userName">مستخدم</span>
                <span id="userRole" class="user-role">مدير</span>
            </div>
            <button id="logoutBtn" class="logout-btn" onclick="logout()">تسجيل الخروج</button>
        </div>
    </div>

    <!-- ==================== SÉLECTEUR DE LANGUE ==================== -->
    <div class="language-switcher">
        <button class="lang-btn active" onclick="changeLanguage('fr')">
            <i class="fas fa-flag"></i> FR
        </button>
        <button class="lang-btn" onclick="changeLanguage('ar')">
            <i class="fas fa-star-and-crescent"></i> AR
        </button>
    </div>

    <!-- ==================== HEADER AVEC MENU HORIZONTAL ==================== -->
    <header>
        <div class="container header-container">
            <div class="logo">
                <i class="fas fa-hands-helping" id="logoIcon"></i>
                <button class="logo-edit-btn" onclick="showLogoModal()">
                    <i class="fas fa-edit"></i>
                </button>
                <div class="logo-text">
                    <h1 id="logoTitle">أنسفال</h1>
                    <p id="logoSubtitle">جمعية التعاون والتنمية والبيئة</p>
                </div>
            </div>
            
            <!-- MENU HORIZONTAL -->
            <nav>
                <ul id="mainMenu">
                    <li><a href="#home" class="active" onclick="showSection('home')">الرئيسية</a></li>
                    <li><a href="#about" onclick="showSection('about')">من نحن</a></li>
                    <li><a href="#gallery" onclick="showSection('gallery')">معرض الصور</a></li>
                    <li><a href="#videos" onclick="showSection('videos')">الفيديوهات</a></li>
                    <li><a href="#projects" onclick="showSection('projects')">المشاريع</a></li>
                    <li><a href="#publications" onclick="showSection('publications')">المنشورات</a></li>
                    <li><a href="#contact" onclick="showSection('contact')">اتصل بنا</a></li>
                    <li><a href="#dashboard" onclick="showSection('dashboard')">لوحة التحكم</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- ==================== MODALES ==================== -->
    <!-- MODALE UPLOAD AVEC CHOIX -->
    <div class="modal-overlay" id="uploadModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="uploadModalTitle">
                    <i class="fas fa-cloud-upload-alt"></i> رفع الملفات
                </h3>
                <button class="close-modal" onclick="hideUploadModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- CHOIX DU MODE D'UPLOAD -->
                <div class="upload-choice">
                    <div class="choice-btn active" id="uploadFromPC" onclick="selectUploadMode('pc')">
                        <i class="fas fa-upload"></i>
                        <h4 id="uploadPcTitle">الرفع من الكمبيوتر</h4>
                        <p id="uploadPcDesc">رفع الملفات من جهازك</p>
                    </div>
                    <div class="choice-btn" id="uploadFromURL" onclick="selectUploadMode('url')">
                        <i class="fas fa-link"></i>
                        <h4 id="uploadUrlTitle">رابط من الإنترنت</h4>
                        <p id="uploadUrlDesc">إضافة روابط Imgur/YouTube</p>
                    </div>
                </div>

                <!-- ZONE UPLOAD DEPUIS PC -->
                <div class="upload-area" id="pcUploadArea">
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <h3 class="upload-text" id="uploadAreaText">اسحب وأفلت ملفاتك هنا</h3>
                    <p class="upload-subtext" id="uploadAreaSubtext">أو انقر لتصفح ملفاتك</p>
                    <div class="size-warning" id="modalSizeWarning" style="margin-top: 15px;"></div>
                    <button class="btn-browse">
                        <i class="fas fa-folder-open"></i> تصفح الملفات
                    </button>
                    <input type="file" id="fileInput" class="file-input" multiple>
                </div>

                <!-- ZONE SAISIE URL -->
                <div class="url-input-area" id="urlUploadArea">
                    <div class="url-input-group">
                        <label id="urlInputLabel">رابط الصورة أو الفيديو</label>
                        <input type="url" id="mediaUrl" placeholder="https://i.imgur.com/..." autocomplete="off">
                        <div class="url-examples">
                            <strong>أمثلة:</strong><br>
                            <span id="urlExamples">
                                • صور Imgur: https://i.imgur.com/rX8QePL.jpeg<br>
                                • فيديو YouTube: https://youtu.be/VIDEO_ID أو https://youtube.com/embed/VIDEO_ID
                            </span>
                        </div>
                    </div>
                    
                    <div class="url-input-group">
                        <label id="mediaTitleLabel">عنوان الوسائط (اختياري)</label>
                        <input type="text" id="mediaTitle" placeholder="مشروع التشجير 2024" autocomplete="off">
                    </div>
                    
                    <button class="btn-browse" onclick="addUrlMedia()" style="width: 100%;">
                        <i class="fas fa-plus"></i> إضافة الرابط
                    </button>
                </div>

                <div class="file-preview">
                    <h4 class="file-preview-title">
                        <i class="fas fa-list"></i> <span id="previewTitle">الملفات المختارة</span>
                    </h4>
                    <div class="files-grid" id="filesGrid"></div>
                    <div class="no-content" id="noFiles" style="display: block;">
                        لم يتم اختيار أي ملف
                    </div>
                </div>

                <div class="upload-progress" id="uploadProgress">
                    <h4 class="file-preview-title">
                        <i class="fas fa-spinner fa-spin"></i> جاري الرفع...
                    </h4>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <p class="progress-text" id="progressText">0%</p>
                </div>

                <!-- MESSAGE DE SUCCÈS AVEC BOUTON OK -->
                <div class="upload-success" id="uploadSuccess">
                    <div class="success-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h3 class="success-text" id="successMessage">تم الرفع بنجاح!</h3>
                    <button class="btn-ok" onclick="hideUploadModal()">
                        <i class="fas fa-check"></i> موافق
                    </button>
                </div>

                <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 30px;" id="actionButtons">
                    <button class="btn-browse" onclick="acceptUpload()" id="acceptBtn" style="background: var(--warning);">
                        <i class="fas fa-check-circle"></i> قبول الملفات
                    </button>
                    <button class="btn-browse" onclick="validateAndUpload()" id="validateBtn" style="background: var(--success); display: none;">
                        <i class="fas fa-check-double"></i> تأكيد ورفع
                    </button>
                    <button class="btn-browse" onclick="hideUploadModal()" style="background: var(--danger);">
                        <i class="fas fa-times"></i> إلغاء
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALE IMPORT JSON -->
    <div class="modal-overlay" id="importModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-file-import"></i> استيراد المحتوى
                </h3>
                <button class="close-modal" onclick="hideImportModal()">&times;</button>
            </div>
            <div class="modal-body">
                <h4 style="color: var(--dark); margin-bottom: 20px; font-size: 1.3rem;">
                    <i class="fas fa-info-circle"></i> كيفية استيراد المحتوى الخاص بك؟
                </h4>
                
                <div class="import-options">
                    <div class="import-option" onclick="importFromFile()">
                        <div class="import-icon">
                            <i class="fas fa-file-import"></i>
                        </div>
                        <h5 class="import-title">ملف .json</h5>
                        <p class="import-desc">استيراد ملف JSON تم إنشاؤه مسبقًا</p>
                        <input type="file" id="jsonFileInput" class="json-input" accept=".json">
                    </div>

                    <div class="import-option" onclick="importFromText()">
                        <div class="import-icon">
                            <i class="fas fa-paste"></i>
                        </div>
                        <h5 class="import-title">لصق JSON</h5>
                        <p class="import-desc">الصق محتوى JSON مباشرة</p>
                    </div>

                    <div class="import-option" onclick="importSample()">
                        <div class="import-icon">
                            <i class="fas fa-magic"></i>
                        </div>
                        <h5 class="import-title">مثال أساسي</h5>
                        <p class="import-desc">تحميل مثال للهيكل</p>
                    </div>
                </div>

                <div id="pasteArea" style="display: none; margin-top: 30px;">
                    <h4 style="color: var(--dark); margin-bottom: 15px;">
                        <i class="fas fa-paste"></i> الصق JSON الخاص بك هنا
                    </h4>
                    <textarea id="jsonTextarea" style="width: 100%; height: 200px; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-family: monospace; resize: vertical;"></textarea>
                    <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 20px;">
                        <button class="btn-browse" onclick="hidePasteArea()" style="background: var(--danger);">
                            <i class="fas fa-times"></i> إلغاء
                        </button>
                        <button class="btn-browse" onclick="processPastedJSON()" style="background: var(--success);">
                            <i class="fas fa-check"></i> استيراد
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALE TEXTE -->
    <div class="modal-overlay" id="textModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-file-alt"></i> إضافة نص
                </h3>
                <button class="close-modal" onclick="hideTextModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 10px; font-weight: 500; color: var(--dark);">
                        <i class="fas fa-heading"></i> عنوان النص
                    </label>
                    <input type="text" id="textTitle" placeholder="مثال: التقرير السنوي 2024" style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 1.1rem;">
                </div>

                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 10px; font-weight: 500; color: var(--dark);">
                        <i class="fas fa-align-left"></i> المحتوى
                    </label>
                    <textarea id="textContent" placeholder="اكتب محتواك هنا..." style="width: 100%; height: 300px; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 1rem; resize: vertical;"></textarea>
                </div>

                <div style="display: flex; gap: 15px; justify-content: flex-end;">
                    <button class="btn-browse" onclick="hideTextModal()" style="background: var(--danger);">
                        <i class="fas fa-times"></i> إلغاء
                    </button>
                    <button class="btn-browse" onclick="saveTextContent()" style="background: var(--success);">
                        <i class="fas fa-save"></i> حفظ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALE GESTION UTILISATEUR (TRADUITE EN FRANÇAIS) -->
    <div class="modal-overlay" id="userModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="userModalTitle">
                    <i class="fas fa-user-plus"></i> Ajouter un utilisateur
                </h3>
                <button class="close-modal" onclick="hideUserModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--dark);">
                        <i class="fas fa-user"></i> Nom d'utilisateur
                    </label>
                    <input type="text" id="userUsername" placeholder="Exemple: admin" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--dark);">
                        <i class="fas fa-lock"></i> Mot de passe
                    </label>
                    <input type="password" id="userPassword" placeholder="Mot de passe" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--dark);">
                        <i class="fas fa-id-card"></i> Nom complet
                    </label>
                    <input type="text" id="userName" placeholder="Exemple: Administrateur" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--dark);">
                        <i class="fas fa-envelope"></i> Email
                    </label>
                    <input type="email" id="userEmail" placeholder="admin@ansfal.org" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                </div>

                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--dark);">
                        <i class="fas fa-user-tag"></i> Rôle
                    </label>
                    <select id="userRole" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                        <option value="admin">Administrateur</option>
                        <option value="webmaster">Webmaster</option>
                        <option value="editor">Éditeur</option>
                    </select>
                </div>

                <div style="display: flex; gap: 15px; justify-content: flex-end;">
                    <button class="btn-browse" onclick="hideUserModal()" style="background: var(--danger);">
                        <i class="fas fa-times"></i> Annuler
                    </button>
                    <button class="btn-browse" onclick="saveUser()" style="background: var(--success);">
                        <i class="fas fa-save"></i> Enregistrer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALE CHANGEMENT DE MOT DE PASSE -->
    <div class="modal-overlay" id="passwordModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="passwordModalTitle">
                    <i class="fas fa-key"></i> Changer le mot de passe
                </h3>
                <button class="close-modal" onclick="hidePasswordModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--dark);">
                        <i class="fas fa-lock"></i> Mot de passe actuel
                    </label>
                    <input type="password" id="currentPassword" placeholder="Mot de passe actuel" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--dark);">
                        <i class="fas fa-lock"></i> Nouveau mot de passe
                    </label>
                    <input type="password" id="newPassword" placeholder="Nouveau mot de passe" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                </div>

                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--dark);">
                        <i class="fas fa-lock"></i> Confirmer le nouveau mot de passe
                    </label>
                    <input type="password" id="confirmPassword" placeholder="Confirmer le nouveau mot de passe" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                </div>

                <div style="display: flex; gap: 15px; justify-content: flex-end;">
                    <button class="btn-browse" onclick="hidePasswordModal()" style="background: var(--danger);">
                        <i class="fas fa-times"></i> Annuler
                    </button>
                    <button class="btn-browse" onclick="changePassword()" style="background: var(--success);">
                        <i class="fas fa-save"></i> Enregistrer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALE CHANGEMENT DE LOGO -->
    <div class="modal-overlay" id="logoModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="logoModalTitle">
                    <i class="fas fa-image"></i> Changer le logo
                </h3>
                <button class="close-modal" onclick="hideLogoModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 30px;">
                    <div id="logoPreview" style="font-size: 4rem; color: var(--primary); margin-bottom: 20px;">
                        <i class="fas fa-hands-helping"></i>
                    </div>
                    <p id="currentLogoText">Logo actuel: Icône mains aidantes</p>
                </div>

                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 10px; font-weight: 500; color: var(--dark);">
                        <i class="fas fa-palette"></i> Choisir une icône de logo
                    </label>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 15px; margin-top: 15px;">
                        <div class="icon-option" onclick="selectLogoIcon('fas fa-hands-helping', 'Mains aidantes')">
                            <i class="fas fa-hands-helping"></i>
                            <small>Mains aidantes</small>
                        </div>
                        <div class="icon-option" onclick="selectLogoIcon('fas fa-tree', 'Arbre')">
                            <i class="fas fa-tree"></i>
                            <small>Arbre</small>
                        </div>
                        <div class="icon-option" onclick="selectLogoIcon('fas fa-leaf', 'Feuille')">
                            <i class="fas fa-leaf"></i>
                            <small>Feuille</small>
                        </div>
                        <div class="icon-option" onclick="selectLogoIcon('fas fa-globe-africa', 'Globe terrestre')">
                            <i class="fas fa-globe-africa"></i>
                            <small>Globe terrestre</small>
                        </div>
                        <div class="icon-option" onclick="selectLogoIcon('fas fa-seedling', 'Jeune plante')">
                            <i class="fas fa-seedling"></i>
                            <small>Jeune plante</small>
                        </div>
                        <div class="icon-option" onclick="selectLogoIcon('fas fa-recycle', 'Recyclage')">
                            <i class="fas fa-recycle"></i>
                            <small>Recyclage</small>
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 10px; font-weight: 500; color: var(--dark);">
                        <i class="fas fa-paint-brush"></i> Couleur du logo
                    </label>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <div class="color-option" style="background: #1a6d2c;" onclick="selectLogoColor('#1a6d2c')"></div>
                        <div class="color-option" style="background: #2e8b57;" onclick="selectLogoColor('#2e8b57')"></div>
                        <div class="color-option" style="background: #3cb371;" onclick="selectLogoColor('#3cb371')"></div>
                        <div class="color-option" style="background: #145a32;" onclick="selectLogoColor('#145a32')"></div>
                        <div class="color-option" style="background: #ff9800;" onclick="selectLogoColor('#ff9800')"></div>
                        <div class="color-option" style="background: #2196F3;" onclick="selectLogoColor('#2196F3')"></div>
                        <div class="color-option" style="background: #9c27b0;" onclick="selectLogoColor('#9c27b0')"></div>
                    </div>
                </div>

                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 10px; font-weight: 500; color: var(--dark);">
                        <i class="fas fa-images"></i> Ou télécharger une image de logo
                    </label>
                    <div class="upload-area" style="padding: 20px;" onclick="document.getElementById('logoImageInput').click()">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <p class="upload-subtext">Cliquez pour télécharger une image de logo</p>
                        <input type="file" id="logoImageInput" class="file-input" accept="image/*">
                    </div>
                </div>

                <div style="display: flex; gap: 15px; justify-content: flex-end;">
                    <button class="btn-browse" onclick="hideLogoModal()" style="background: var(--danger);">
                        <i class="fas fa-times"></i> Annuler
                    </button>
                    <button class="btn-browse" onclick="saveLogo()" style="background: var(--success);">
                        <i class="fas fa-save"></i> Enregistrer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALE VISUALISATION DE FICHIER -->
    <div class="file-viewer" id="fileViewer">
        <div class="file-viewer-content">
            <div class="file-viewer-header">
                <h3 id="viewerTitle"></h3>
                <button class="close-viewer" onclick="closeFileViewer()">&times;</button>
            </div>
            <div class="file-viewer-body" id="viewerContent"></div>
        </div>
    </div>

    <!-- ==================== SECTIONS DU SITE ==================== -->
    <!-- SECTION HÉRO -->
    <section class="hero active" id="home">
        <div class="container">
            <h2>جمعية أنسفال</h2>
            <h3>للتـعاون والتنميـة والبيئـة</h3>
            <p>نعمل من أجل تنمية مستدامة، تعاون وطني وحماية البيئة منذ سنة 2023.</p>
            <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 30px;">
                <a href="#projects" class="btn" onclick="showSection('projects')">اكتشف مبادراتنا</a>
                <a href="#gallery" class="btn" style="background-color: var(--info); border-color: var(--info);" onclick="showSection('gallery')">
                    <i class="fas fa-images"></i> معرض الصور
                </a>
                <a href="#publications" class="btn" style="background-color: var(--warning); border-color: var(--warning);" onclick="showSection('publications')">
                    <i class="fas fa-file-alt"></i> المنشورات
                </a>
            </div>
        </div>
    </section>

    <!-- À PROPOS -->
    <section class="about" id="about">
        <div class="container">
            <div class="section-header">
                <h2>مـن نحـن</h2>
            </div>
            <div class="about-content">
                <div class="about-text">
                    <h3>تـاريخـنــا</h3>
                    <p>تأسست سنة 2023، جمعية أنسفال للتعاون والتنمية والبيئة انبثقت من قناعة أن التنمية البشرية وحماية البيئة يجب أن يسيرا جنباً إلى جنب.</p>
                    <p>اسم "أنسفال" يرمز لالتزامنا من أجل مستقبل أفضل، مبني على التضامن، التنمية المستدامة والحفاظ على بيئتنا.</p>
                </div>
                <div class="about-img">
                    <img src="https://images.unsplash.com/photo-1542601906990-b4d3fb778b09?ixlib=rb-4.0.3&auto=format&fit=crop&w=1470&q=80" alt="فريق أنسفال">
                </div>
            </div>
        </div>
    </section>

    <!-- GALERIE (Images téléversées) -->
    <section class="gallery" id="gallery">
        <div class="container">
            <div class="section-header">
                <h2>معرض الصور</h2>
            </div>
            <div class="gallery-public" id="publicGallery">
                <!-- Les images téléversées s'afficheront ici automatiquement -->
                <div class="no-content" id="noGalleryPublic">لا توجد صور متاحة حالياً.</div>
            </div>
        </div>
    </section>

    <!-- VIDÉOS (Vidéos téléversées) -->
    <section class="videos" id="videos">
        <div class="container">
            <div class="section-header">
                <h2>الفيديوهات</h2>
            </div>
            <div class="videos-public" id="publicVideos">
                <!-- Les vidéos téléversées s'afficheront ici automatiquement -->
                <div class="no-content" id="noVideosPublic">لا توجد فيديوهات متاحة حالياً.</div>
            </div>
        </div>
    </section>

    <!-- PROJETS -->
    <section class="projects" id="projects">
        <div class="container">
            <div class="section-header">
                <h2>مشاريعنا</h2>
            </div>
            <div class="projects-container" id="projectsContainer">
                <div class="project-card">
                    <div class="project-img">
                        <img src="https://images.unsplash.com/photo-1542601906990-b4d3fb778b09?ixlib=rb-4.0.3&auto=format&fit=crop&w=1470&q=80" alt="مشروع البيئة">
                    </div>
                    <div class="project-info">
                        <h3>حماية الغابات</h3>
                        <p>حملة تشجير وتوعية بحماية النظم البيئية الغابوية.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- PUBLICATIONS (PDFs et textes téléversés) -->
    <section class="publications" id="publications">
        <div class="container">
            <div class="section-header">
                <h2>المنشورات</h2>
            </div>
            <div class="publications-grid" id="publicPublications">
                <!-- Les PDFs et textes téléversés s'afficheront ici automatiquement -->
                <div class="no-content" id="noPublicationsPublic">لا توجد منشورات متاحة حالياً.</div>
            </div>
        </div>
    </section>

    <!-- CONTACT -->
    <section class="contact" id="contact">
        <div class="container">
            <h2>اتصل بنا</h2>
            <div class="contact-info">
                <div class="contact-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <h3>العنوان</h3>
                    <p>المغرب</p>
                </div>
                <div class="contact-item">
                    <i class="fas fa-phone"></i>
                    <h3>الهاتف</h3>
                    <p>+212 6 12 34 56 78</p>
                </div>
                <div class="contact-item">
                    <i class="fas fa-envelope"></i>
                    <h3>البريد الإلكتروني</h3>
                    <p>contact@ansfal.org</p>
                </div>
            </div>
        </div>
    </section>

    <!-- DASHBOARD ANSFAL -->
    <section id="dashboard" class="dashboard-section">
        <div class="dashboard-container">
            <div class="dashboard-sidebar">
                <ul class="sidebar-menu" id="sidebarMenu">
                    <li><a href="#" data-page="dashboard" class="active" onclick="showDashboardSection('dashboard')"><i class="fas fa-tachometer-alt"></i> لوحة التحكم</a></li>
                    <li><a href="#" data-section="gallery" onclick="showDashboardSection('gallery')"><i class="fas fa-images"></i> معرض الصور</a></li>
                    <li><a href="#" data-section="videos" onclick="showDashboardSection('videos')"><i class="fas fa-video"></i> الفيديوهات</a></li>
                    <li><a href="#" data-section="documents" onclick="showDashboardSection('documents')"><i class="fas fa-file-pdf"></i> المستندات</a></li>
                    <li><a href="#" data-section="text" onclick="showDashboardSection('text')"><i class="fas fa-file-alt"></i> النصوص</a></li>
                    <li><a href="#" data-page="users" onclick="showDashboardSection('users')"><i class="fas fa-users"></i> المستخدمين</a></li>
                    <li><a href="#" data-page="settings" onclick="showDashboardSection('settings')"><i class="fas fa-cog"></i> الإعدادات</a></li>
                </ul>
            </div>
            <div class="dashboard-content">
                <h1 class="page-title">لوحة تحكم أنسفال</h1>
                
                <!-- Dashboard Principal (Statistiques) -->
                <div id="dashboardDashboard" class="dashboard-section-content active">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>إجمالي الزوار</h3>
                            <div class="stat-number" id="totalVisitorsStat">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>الوسائط</h3>
                            <div class="stat-number" id="totalMediaStat">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>المستخدمين</h3>
                            <div class="stat-number" id="totalUsersStat">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>التعليقات</h3>
                            <div class="stat-number" id="totalCommentsStat">0</div>
                        </div>
                    </div>
                </div>
                
                <!-- Section Galerie -->
                <div id="galleryDashboard" class="dashboard-section-content">
                    <h2>إدارة الصور</h2>
                    <div class="section-actions">
                        <button class="btn-import" onclick="showUploadModal('image')">
                            <i class="fas fa-cloud-upload-alt"></i> إضافة صور
                        </button>
                        <button class="btn-import" onclick="exportSection('image')" style="background: var(--info);">
                            <i class="fas fa-file-export"></i> تصدير الصور
                        </button>
                    </div>
                    <div class="items-grid" id="galleryList">
                        <!-- Liste des images sera chargée ici -->
                    </div>
                </div>
                
                <!-- Section Vidéos -->
                <div id="videosDashboard" class="dashboard-section-content">
                    <h2>إدارة الفيديوهات</h2>
                    <div class="section-actions">
                        <button class="btn-import" onclick="showUploadModal('video')">
                            <i class="fas fa-cloud-upload-alt"></i> إضافة فيديوهات
                        </button>
                        <button class="btn-import" onclick="exportSection('video')" style="background: var(--info);">
                            <i class="fas fa-file-export"></i> تصدير الفيديوهات
                        </button>
                    </div>
                    <div class="items-grid" id="videosList">
                        <!-- Liste des vidéos sera chargée ici -->
                    </div>
                </div>
                
                <!-- Section Documents -->
                <div id="documentsDashboard" class="dashboard-section-content">
                    <h2>إدارة المستندات</h2>
                    <div class="section-actions">
                        <button class="btn-import" onclick="showUploadModal('pdf')">
                            <i class="fas fa-cloud-upload-alt"></i> إضافة مستندات PDF
                        </button>
                        <button class="btn-import" onclick="exportSection('pdf')" style="background: var(--info);">
                            <i class="fas fa-file-export"></i> تصدير المستندات
                        </button>
                    </div>
                    <div class="items-grid" id="documentsList">
                        <!-- Liste des documents sera chargée ici -->
                    </div>
                </div>
                
                <!-- Section Textes -->
                <div id="textDashboard" class="dashboard-section-content">
                    <h2>إدارة النصوص</h2>
                    <div class="section-actions">
                        <button class="btn-import" onclick="showUploadModal('text')">
                            <i class="fas fa-file-alt"></i> إضافة نص
                        </button>
                        <button class="btn-import" onclick="exportSection('text')" style="background: var(--info);">
                            <i class="fas fa-file-export"></i> تصدير النصوص
                        </button>
                    </div>
                    <div class="items-grid" id="textList">
                        <!-- Liste des textes sera chargée ici -->
                    </div>
                </div>
                
                <!-- Section Utilisateurs (Traduite en français) -->
                <div id="usersDashboard" class="dashboard-section-content">
                    <h2>Gestion des utilisateurs</h2>
                    <div class="section-actions">
                        <button class="btn-import" onclick="showAddUserModal()">
                            <i class="fas fa-user-plus"></i> Ajouter un utilisateur
                        </button>
                        <button class="btn-import" onclick="exportUsers()" style="background: var(--info);">
                            <i class="fas fa-file-export"></i> Exporter les utilisateurs
                        </button>
                    </div>
                    <div class="items-grid" id="usersList">
                        <!-- Liste des utilisateurs sera chargée ici -->
                    </div>
                </div>
                
                <!-- Section Paramètres -->
                <div id="settingsDashboard" class="dashboard-section-content">
                    <h2>الإعدادات</h2>
                    <div class="section-actions">
                        <button class="btn-import" onclick="showPasswordModal()">
                            <i class="fas fa-key"></i> تغيير كلمة المرور
                        </button>
                        <button class="btn-import" onclick="exportToJSON()">
                            <i class="fas fa-file-export"></i> تصدير جميع البيانات
                        </button>
                        <button class="btn-import" onclick="resetAllData()" style="background: var(--danger);">
                            <i class="fas fa-trash"></i> مسح جميع البيانات
                        </button>
                    </div>
                    <div class="settings-grid" style="margin-top: 30px;">
                        <div class="setting-item">
                            <h4>حجم التخزين المحلي</h4>
                            <div class="progress-bar" style="height: 15px; margin: 10px 0;">
                                <div class="progress-fill" id="storageUsage" style="height: 100%;"></div>
                            </div>
                            <p id="storageText">جاري حساب حجم التخزين...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- DASHBOARD SIMPLIFIÉ (Caché si non admin) -->
    <section id="simple-dashboard" class="dashboard-simple">
        <div class="simple-container">
            <div class="simple-header">
                <h1><i class="fas fa-cloud-upload-alt"></i> مدير الوسائط</h1>
                <p>رفع، تنظيم وإدارة الوسائط الخاصة بك</p>
            </div>

            <div class="simple-dashboard">
                <div class="dashboard-header">
                    <h2 class="dashboard-title">لوحة تحكم الملفات</h2>
                    <div style="display: flex; gap: 15px;">
                        <button class="btn-import" onclick="showImportModal()">
                            <i class="fas fa-file-import"></i> استيراد .json
                        </button>
                        <button class="btn-import" onclick="exportToJSON()" style="background: var(--info);">
                            <i class="fas fa-file-export"></i> تصدير الكل
                        </button>
                        <button class="btn-import" onclick="resetAllData()" style="background: var(--danger);">
                            <i class="fas fa-trash"></i> مسح الكل
                        </button>
                    </div>
                </div>

                <!-- SECTIONS AMÉLIORÉES -->
                <div class="sections-grid">
                    <!-- GALERIE -->
                    <div class="section-card" id="gallerySection">
                        <div class="section-header">
                            <div class="section-title">
                                <div class="section-icon">
                                    <i class="fas fa-images"></i>
                                </div>
                                معرض الصور
                            </div>
                            <button class="btn-quick-add" onclick="showDashboardSection('gallery')">
                                <i class="fas fa-cog"></i> إدارة
                            </button>
                        </div>
                        <div class="section-content">
                            <p>أضف صور إلى معرضك. الصيغ المدعومة: JPG, PNG, GIF, WebP</p>
                            <div class="size-warning" id="imageSizeWarning" style="display: none;">
                                <i class="fas fa-exclamation-triangle"></i> الحد الأقصى: 20 ميجابايت لكل صورة
                            </div>
                            <div class="content-preview" id="galleryPreview"></div>
                            <div class="no-content" id="galleryEmpty">لم تتم إضافة أي صور</div>
                        </div>
                        <button class="btn-add-large" onclick="showDashboardSection('gallery')">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>

                    <!-- VIDÉOS -->
                    <div class="section-card" id="videosSection">
                        <div class="section-header">
                            <div class="section-title">
                                <div class="section-icon">
                                    <i class="fas fa-video"></i>
                                </div>
                                الفيديوهات
                            </div>
                            <button class="btn-quick-add" onclick="showDashboardSection('videos')">
                                <i class="fas fa-cog"></i> إدارة
                            </button>
                        </div>
                        <div class="section-content">
                            <p>استورد فيديوهاتك. الصيغ المدعومة: MP4, WebM, AVI, MOV, MKV</p>
                            <div class="size-warning">
                                <i class="fas fa-exclamation-triangle"></i> الحد الأقصى: 100 ميجابايت لكل فيديو
                            </div>
                            <div class="content-preview" id="videosPreview"></div>
                            <div class="no-content" id="videosEmpty">لم تتم إضافة أي فيديوهات</div>
                        </div>
                        <button class="btn-add-large" onclick="showDashboardSection('videos')">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>

                    <!-- DOCUMENTS -->
                    <div class="section-card" id="documentsSection">
                        <div class="section-header">
                            <div class="section-title">
                                <div class="section-icon">
                                    <i class="fas fa-file-pdf"></i>
                                </div>
                                مستندات PDF
                            </div>
                            <button class="btn-quick-add" onclick="showDashboardSection('documents')">
                                <i class="fas fa-cog"></i> إدارة
                            </button>
                        </div>
                        <div class="section-content">
                            <p>ارفع مستندات PDF، تقارير، منشورات</p>
                            <div class="size-warning" id="pdfSizeWarning" style="display: none;">
                                <i class="fas fa-exclamation-triangle"></i> الحد الأقصى: 50 ميجابايت لكل PDF
                            </div>
                            <div class="content-preview" id="documentsPreview"></div>
                            <div class="no-content" id="documentsEmpty">لم تتم إضافة أي مستندات</div>
                        </div>
                        <button class="btn-add-large" onclick="showDashboardSection('documents')">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>

                    <!-- TEXTE -->
                    <div class="section-card" id="textSection">
                        <div class="section-header">
                            <div class="section-title">
                                <div class="section-icon">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                المحتوى النصي
                            </div>
                            <button class="btn-quick-add" onclick="showDashboardSection('text')">
                                <i class="fas fa-cog"></i> إدارة
                            </button>
                        </div>
                        <div class="section-content">
                            <p>أضف نص (TXT, DOC, DOCX) أو اكتب مباشرة</p>
                            <div class="size-warning" id="textSizeWarning" style="display: none;">
                                <i class="fas fa-exclamation-triangle"></i> الحد الأقصى: 10 ميجابايت لكل ملف نصي
                            </div>
                            <div class="content-preview" id="textPreview"></div>
                            <div class="no-content" id="textEmpty">لا يوجد محتوى نصي</div>
                        </div>
                        <button class="btn-add-large" onclick="showDashboardSection('text')">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
            </div>

            <div class="footer">
                <p><i class="fas fa-shield-alt"></i> جميع ملفاتك محفوظة محلياً</p>
            </div>
        </div>
    </section>

    <!-- ==================== FOOTER ==================== -->
    <footer>
        <div class="container">
            <div class="footer-container">
                <div class="footer-logo">
                    <div class="logo">
                        <i class="fas fa-hands-helping" id="footerLogoIcon"></i>
                        <div class="logo-text">
                            <h3 style="color: white;" id="footerLogoTitle">أنسفال</h3>
                            <p style="color: rgba(255,255,255,0.8);" id="footerLogoSubtitle">جمعية التعاون والتنمية والبيئة</p>
                        </div>
                    </div>
                </div>
                <div class="footer-social">
                    <h4>تابعنا</h4>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2024 جمعية أنسفال. جميع الحقوق محفوظة.</p>
            </div>
        </div>
    </footer>

    <!-- ==================== BOUTONS FLOTTANTS ==================== -->
    <a href="#" class="whatsapp-float" id="whatsappBtn">
        <i class="fab fa-whatsapp"></i>
    </a>

    <button class="btn-add-float" id="addBtn">
        <i class="fas fa-plus"></i>
    </button>

    <button class="login-btn" id="loginBtn">
        <i class="fas fa-user-shield"></i>
    </button>

    <!-- ==================== JAVASCRIPT CORRIGÉ ==================== -->
    <script>
        // Variables globales
        let currentUser = null;
        let currentLanguage = 'fr';
        let currentUploadType = null;
        let selectedFiles = [];
        let currentEditingUserId = null;
        let selectedLogoIcon = 'fas fa-hands-helping';
        let selectedLogoColor = '#1a6d2c';
        let selectedLogoImage = null;
        let isFirstLogin = false;
        let uploadMode = 'pc'; // 'pc' ou 'url'
        
        // Traductions
        const translations = {
            fr: {
                // Compteur de visiteurs
                visitors: "Visiteurs",
                online: "En ligne",
                lastVisit: "Dernière visite",
                
                // Authentification
                username: "Nom d'utilisateur",
                password: "Mot de passe",
                login: "Connexion",
                logout: "Déconnexion",
                admin: "Admin",
                webmaster: "Webmaster",
                editor: "Éditeur",
                
                // Menu
                home: "Accueil",
                about: "À propos",
                gallery: "Galerie",
                videos: "Vidéos",
                projects: "Projets",
                publications: "Publications",
                contact: "Contact",
                dashboard: "Dashboard",
                mediaManager: "Gestionnaire de Médias",
                
                // Dashboard Menu
                dashboardMenu: {
                    dashboard: "Tableau de bord",
                    gallery: "Galerie",
                    videos: "Vidéos",
                    documents: "Documents",
                    text: "Textes",
                    users: "Utilisateurs",
                    settings: "Paramètres"
                },
                
                // Héros
                heroTitle: "أنسفال",
                heroSubtitle: "جمعية التعاون والتنمية والبيئة",
                heroText: "Œuvrant pour un développement durable, la coopération nationale et la protection de l'environnement depuis 2023.",
                discover: "Découvrir nos actions",
                
                // Sections
                aboutTitle: "À propos d'أنسفال",
                aboutHistory: "Notre histoire",
                aboutText1: "Fondée en 2023, l'Association أنسفال POUR LA COOPÉRATION ET LE DÉVELOPPEMENT ET L'ENVIRONNEMENT est née de la conviction que le développement humain et la protection environnementale doivent aller de pair.",
                aboutText2: "Notre nom 'أنسفال' symbolise notre engagement pour un avenir meilleur, basé sur la solidarité, le développement durable et la préservation de notre environnement.",
                
                galleryTitle: "Galerie Photos",
                noGallery: "Aucune image disponible pour le moment.",
                
                videosTitle: "Vidéos",
                noVideos: "Aucune vidéo disponible pour le moment.",
                
                projectsTitle: "Nos Projets",
                project1Title: "Protection des Forêts",
                project1Desc: "Campagne de reboisement et sensibilisation à la protection des écosystèmes forestiers.",
                
                publicationsTitle: "Publications",
                noPublications: "Aucune publication disponible pour le moment.",
                
                contactTitle: "Contactez-nous",
                address: "Adresse",
                phone: "Téléphone",
                email: "Email",
                location: "Maroc",
                
                // Dashboard
                dashboardTitle: "Tableau de Bord أنسفال",
                totalVisitors: "Visiteurs Totaux",
                media: "Médias",
                users: "Utilisateurs",
                comments: "Commentaires",
                
                // Media Manager
                mediaManagerTitle: "Gestionnaire de Médias",
                mediaManagerSubtitle: "Téléversez et gérez vos images, vidéos, documents et textes",
                importJson: "Importer un .json",
                exportAll: "Exporter tout",
                clearAll: "Tout effacer",
                photosGallery: "Galerie Photos",
                manage: "Gérer",
                supportedFormats: "Formats supportés",
                maxSize: "Taille max",
                noImages: "Aucune image ajoutée",
                videos: "Vidéos",
                noVideosAdded: "Aucune vidéo ajoutée",
                pdfDocuments: "Documents PDF",
                noDocuments: "Aucun document ajouté",
                textContent: "Contenu Textuel",
                noTextContent: "Aucun contenu textuel",
                filesSaved: "Tous vos fichiers sont sauvegardés localement",
                
                // Gestion Utilisateurs (TRADUITE EN FRANÇAIS)
                addUser: "Ajouter un utilisateur",
                editUser: "Modifier l'utilisateur",
                usersManagement: "Gestion des utilisateurs",
                changePassword: "Changer le mot de passe",
                changeLogo: "Changer le logo",
                
                // Modales
                uploadFiles: "Téléverser des fichiers",
                uploadFromPC: "Upload depuis PC",
                uploadFromPCDesc: "Téléverser des fichiers depuis votre ordinateur",
                uploadFromURL: "Lien depuis Internet",
                uploadFromURLDesc: "Ajouter des liens Imgur/YouTube",
                urlInputLabel: "URL de l'image ou de la vidéo",
                urlExamples: "• Images Imgur: https://i.imgur.com/...\n• Vidéo YouTube: https://youtu.be/VIDEO_ID ou https://youtube.com/embed/VIDEO_ID",
                mediaTitleLabel: "Titre du média (optionnel)",
                addUrlButton: "Ajouter le lien",
                dragDrop: "Glissez-déposez vos fichiers ici",
                orClick: "ou cliquez pour parcourir vos fichiers",
                browseFiles: "Parcourir les fichiers",
                selectedFiles: "Fichiers sélectionnés",
                noFilesSelected: "Aucun fichier sélectionné",
                uploading: "Téléversement en cours...",
                cancel: "Annuler",
                upload: "Téléverser",
                uploadSuccess: "Téléversement réussi !",
                ok: "OK",
                
                importContent: "Importer du contenu",
                howToImport: "Comment importer votre contenu ?",
                jsonFile: "Fichier .json",
                importJsonDesc: "Importez un fichier JSON généré précédemment",
                pasteJson: "Coller du JSON",
                pasteJsonDesc: "Collez directement le contenu JSON",
                sample: "Exemple de base",
                sampleDesc: "Chargez un exemple de structure",
                pasteHere: "Collez votre JSON ici",
                import: "Importer",
                
                addText: "Ajouter du texte",
                textTitle: "Titre du texte",
                textContent: "Contenu",
                save: "Enregistrer",
                
                // Alerts
                loginSuccess: "Connexion réussie !",
                loginError: "Identifiants incorrects",
                logoutSuccess: "Déconnexion réussie",
                pleaseLogin: "Veuillez vous connecter pour accéder au gestionnaire de fichiers",
                selectFile: "Veuillez sélectionner au moins un fichier",
                fileTooLarge: "Le fichier dépasse la taille maximale",
                invalidFormat: "Le fichier n'est pas un format valide",
                invalidUrl: "URL invalide",
                urlAdded: "URL ajoutée avec succès",
                textRequired: "Veuillez remplir le titre et le contenu",
                textSaved: "Texte enregistré avec succès !",
                importSuccess: "éléments importés avec succès !",
                exportSuccess: "Données exportées avec succès !",
                clearConfirm: "Êtes-vous sûr de vouloir effacer TOUTES les données ? Cette action est irréversible.",
                allDataCleared: "Toutes les données ont été effacées",
                userSaved: "Utilisateur enregistré avec succès",
                userDeleted: "Utilisateur supprimé avec succès",
                passwordChanged: "Mot de passe changé avec succès",
                passwordMismatch: "Les mots de passe ne correspondent pas",
                currentPasswordWrong: "Mot de passe actuel incorrect",
                logoChanged: "Logo changé avec succès",
                firstLoginPassword: "C'est votre première connexion. Veuillez changer votre mot de passe.",
                
                // Footer
                followUs: "Suivez-nous",
                rights: "Tous droits réservés"
            },
            ar: {
                // Compteur de visiteurs
                visitors: "زوار",
                online: "متصلون",
                lastVisit: "آخر زيارة",
                
                // Authentification
                username: "اسم المستخدم",
                password: "كلمة المرور",
                login: "تسجيل الدخول",
                logout: "تسجيل الخروج",
                admin: "مدير",
                webmaster: "ويب ماستر",
                editor: "محرر",
                
                // Menu
                home: "الرئيسية",
                about: "من نحن",
                gallery: "معرض الصور",
                videos: "الفيديوهات",
                projects: "المشاريع",
                publications: "المنشورات",
                contact: "اتصل بنا",
                dashboard: "لوحة التحكم",
                mediaManager: "مدير الوسائط",
                
                // Dashboard Menu
                dashboardMenu: {
                    dashboard: "لوحة التحكم",
                    gallery: "معرض الصور",
                    videos: "الفيديوهات",
                    documents: "المستندات",
                    text: "النصوص",
                    users: "المستخدمين",
                    settings: "الإعدادات"
                },
                
                // Héros
                heroTitle: "جمعية أنسفال",
                heroSubtitle: "للتـعاون والتنميـة والبيئـة",
                heroText: "نعمل من أجل تنمية مستدامة، تعاون وطني وحماية البيئة منذ سنة 2023.",
                discover: "اكتشف مبادراتنا",
                
                // Sections
                aboutTitle: "مـن نحـن",
                aboutHistory: "تـاريخـنــا",
                aboutText1: "تأسست سنة 2023، جمعية أنسفال للتعاون والتنمية والبيئة انبثقت من قناعة أن التنمية البشرية وحماية البيئة يجب أن يسيرا جنباً إلى جنب.",
                aboutText2: "اسم \"أنسفال\" يرمز لالتزامنا من أجل مستقبل أفضل، مبني على التضامن، التنمية المستدامة والحفاظ على بيئتنا.",
                
                galleryTitle: "معرض الصور",
                noGallery: "لا توجد صور متاحة حالياً.",
                
                videosTitle: "الفيديوهات",
                noVideos: "لا توجد فيديوهات متاحة حالياً.",
                
                projectsTitle: "مشاريعنا",
                project1Title: "حماية الغابات",
                project1Desc: "حملة تشجير وتوعية بحماية النظم البيئية الغابوية.",
                
                publicationsTitle: "المنشورات",
                noPublications: "لا توجد منشورات متاحة حالياً.",
                
                contactTitle: "اتصل بنا",
                address: "العنوان",
                phone: "الهاتف",
                email: "البريد الإلكتروني",
                location: "المغرب",
                
                // Dashboard
                dashboardTitle: "لوحة تحكم أنسفال",
                totalVisitors: "إجمالي الزوار",
                media: "الوسائط",
                users: "المستخدمين",
                comments: "التعليقات",
                
                // Media Manager
                mediaManagerTitle: "مدير الوسائط",
                mediaManagerSubtitle: "رفع، تنظيم وإدارة الوسائط الخاصة بك",
                importJson: "استيراد .json",
                exportAll: "تصدير الكل",
                clearAll: "مسح الكل",
                photosGallery: "معرض الصور",
                manage: "إدارة",
                supportedFormats: "الصيغ المدعومة",
                maxSize: "الحد الأقصى",
                noImages: "لم تتم إضافة أي صور",
                videos: "الفيديوهات",
                noVideosAdded: "لم تتم إضافة أي فيديوهات",
                pdfDocuments: "مستندات PDF",
                noDocuments: "لم تتم إضافة أي مستندات",
                textContent: "المحتوى النصي",
                noTextContent: "لا يوجد محتوى نصي",
                filesSaved: "جميع ملفاتك محفوظة محلياً",
                
                // Gestion Utilisateurs
                addUser: "إضافة مستخدم",
                editUser: "تعديل المستخدم",
                usersManagement: "إدارة المستخدمين",
                changePassword: "تغيير كلمة المرور",
                changeLogo: "تغيير الشعار",
                
                // Modales
                uploadFiles: "رفع الملفات",
                uploadFromPC: "الرفع من الكمبيوتر",
                uploadFromPCDesc: "رفع الملفات من جهازك",
                uploadFromURL: "رابط من الإنترنت",
                uploadFromURLDesc: "إضافة روابط Imgur/YouTube",
                urlInputLabel: "رابط الصورة أو الفيديو",
                urlExamples: "• صور Imgur: https://i.imgur.com/...\n• فيديو YouTube: https://youtu.be/VIDEO_ID أو https://youtube.com/embed/VIDEO_ID",
                mediaTitleLabel: "عنوان الوسائط (اختياري)",
                addUrlButton: "إضافة الرابط",
                dragDrop: "اسحب وأفلت ملفاتك هنا",
                orClick: "أو انقر لتصفح ملفاتك",
                browseFiles: "تصفح الملفات",
                selectedFiles: "الملفات المختارة",
                noFilesSelected: "لم يتم اختيار أي ملف",
                uploading: "جاري الرفع...",
                cancel: "إلغاء",
                upload: "رفع",
                uploadSuccess: "تم الرفع بنجاح!",
                ok: "موافق",
                
                importContent: "استيراد المحتوى",
                howToImport: "كيفية استيراد المحتوى الخاص بك؟",
                jsonFile: "ملف .json",
                importJsonDesc: "استيراد ملف JSON تم إنشاؤه مسبقاً",
                pasteJson: "لصق JSON",
                pasteJsonDesc: "الصق محتوى JSON مباشرة",
                sample: "مثال أساسي",
                sampleDesc: "تحميل مثال للهيكل",
                pasteHere: "الصق JSON الخاص بك هنا",
                import: "استيراد",
                
                addText: "إضافة نص",
                textTitle: "عنوان النص",
                textContent: "المحتوى",
                save: "حفظ",
                
                // Alerts
                loginSuccess: "تم تسجيل الدخول بنجاح!",
                loginError: "بيانات الدخول غير صحيحة",
                logoutSuccess: "تم تسجيل الخروج بنجاح",
                pleaseLogin: "يرجى تسجيل الدخول للوصول إلى مدير الوسائط",
                selectFile: "يرجى اختيار ملف واحد على الأقل",
                fileTooLarge: "الملف يتجاوز الحد الأقصى للحجم",
                invalidFormat: "الملف ليس بصيغة صالحة",
                invalidUrl: "رابط غير صالح",
                urlAdded: "تم إضافة الرابط بنجاح",
                textRequired: "يرجى ملء العنوان والمحتوى",
                textSaved: "تم حفظ النص بنجاح!",
                importSuccess: "عناصر تم استيرادها بنجاح!",
                exportSuccess: "تم تصدير البيانات بنجاح!",
                clearConfirm: "هل أنت متأكد من رغبتك في حذف جميع البيانات؟ هذا الإجراء لا يمكن التراجع عنه.",
                allDataCleared: "تم حذف جميع البيانات",
                userSaved: "تم حفظ المستخدم بنجاح",
                userDeleted: "تم حذف المستخدم بنجاح",
                passwordChanged: "تم تغيير كلمة المرور بنجاح",
                passwordMismatch: "كلمات المرور لا تتطابق",
                currentPasswordWrong: "كلمة المرور الحالية غير صحيحة",
                logoChanged: "تم تغيير الشعار بنجاح",
                firstLoginPassword: "هذه هي أول مرة تقوم بتسجيل الدخول. يرجى تغيير كلمة المرور.",
                
                // Footer
                followUs: "تابعنا",
                rights: "جميع الحقوق محفوظة"
            }
        };

        // Tailles maximales par type de fichier (en bytes)
        const MAX_FILE_SIZES = {
            'image': 20 * 1024 * 1024,     // 2000MB pour les images
            'video': 100 * 1024 * 1024,    // 1000MB pour les vidéos
            'pdf': 50 * 1024 * 1024,       // 500MB pour les PDF
            'text': 10 * 1024 * 1024       // 1000MB pour les textes
        };

        // Types de fichiers acceptés par catégorie
        const ACCEPTED_FILES = {
            'image': '.jpg,.jpeg,.png,.gif,.webp,.bmp',
            'video': '.mp4,.webm,.avi,.mov,.mkv',
            'pdf': '.pdf',
            'text': '.txt,.doc,.docx,.rtf'
        };

        // Icônes par type de fichier
        const FILE_ICONS = {
            'image': 'fas fa-image',
            'video': 'fas fa-video',
            'pdf': 'fas fa-file-pdf',
            'txt': 'fas fa-file-alt',
            'doc': 'fas fa-file-word',
            'docx': 'fas fa-file-word',
            'rtf': 'fas fa-file-alt',
            'default': 'fas fa-file'
        };

        // ==================== FONCTIONS DE TRADUCTION ====================
        function translatePage(lang) {
            const t = translations[lang];
            
            // Mettre à jour les textes
            document.getElementById('visitorsLabel').innerHTML = `${t.visitors}: <span class="visitor-count" id="totalVisitors">0</span>`;
            document.getElementById('onlineLabel').innerHTML = `${t.online}: <span class="visitor-count" id="onlineVisitors">0</span>`;
            document.getElementById('lastVisitLabel').innerHTML = `${t.lastVisit}: <span id="lastVisit">--/--/---- --:--:--</span>`;
            
            // Authentification
            document.getElementById('username').placeholder = t.username;
            document.getElementById('password').placeholder = t.password;
            document.querySelector('#loginForm button').textContent = t.login;
            document.getElementById('logoutBtn').textContent = t.logout;
            
            // Menu principal
            const menuItems = document.querySelectorAll('#mainMenu a');
            menuItems[0].textContent = t.home;
            menuItems[1].textContent = t.about;
            menuItems[2].textContent = t.gallery;
            menuItems[3].textContent = t.videos;
            menuItems[4].textContent = t.projects;
            menuItems[5].textContent = t.publications;
            menuItems[6].textContent = t.contact;
            menuItems[7].textContent = t.dashboard;
            
            // Logo
            document.getElementById('logoTitle').textContent = 'أنسفال';
            document.getElementById('logoSubtitle').textContent = t.heroSubtitle;
            
            // Menu du dashboard
            const dashboardMenuItems = document.querySelectorAll('.sidebar-menu a');
            if (dashboardMenuItems.length > 0) {
                dashboardMenuItems[0].innerHTML = `<i class="fas fa-tachometer-alt"></i> ${t.dashboardMenu.dashboard}`;
                dashboardMenuItems[1].innerHTML = `<i class="fas fa-images"></i> ${t.dashboardMenu.gallery}`;
                dashboardMenuItems[2].innerHTML = `<i class="fas fa-video"></i> ${t.dashboardMenu.videos}`;
                dashboardMenuItems[3].innerHTML = `<i class="fas fa-file-pdf"></i> ${t.dashboardMenu.documents}`;
                dashboardMenuItems[4].innerHTML = `<i class="fas fa-file-alt"></i> ${t.dashboardMenu.text}`;
                dashboardMenuItems[5].innerHTML = `<i class="fas fa-users"></i> ${t.dashboardMenu.users}`;
                dashboardMenuItems[6].innerHTML = `<i class="fas fa-cog"></i> ${t.dashboardMenu.settings}`;
            }
            
            // Titres des sections dashboard
            document.querySelector('#usersDashboard h2').textContent = t.usersManagement;
            document.querySelector('#settingsDashboard h2').textContent = t.dashboardMenu.settings;
            
            // Section Héros
            document.querySelector('#home h2').textContent = t.heroTitle;
            document.querySelector('#home h3').textContent = t.heroSubtitle;
            document.querySelector('#home p').textContent = t.heroText;
            document.querySelector('#home .btn').textContent = t.discover;
            
            // Section À propos
            document.querySelector('#about .section-header h2').textContent = t.aboutTitle;
            document.querySelector('#about .about-text h3').textContent = t.aboutHistory;
            document.querySelector('#about .about-text p:nth-child(2)').textContent = t.aboutText1;
            document.querySelector('#about .about-text p:nth-child(3)').textContent = t.aboutText2;
            
            // Section Galerie
            document.querySelector('#gallery .section-header h2').textContent = t.galleryTitle;
            document.querySelector('#noGalleryPublic').textContent = t.noGallery;
            
            // Section Vidéos
            document.querySelector('#videos .section-header h2').textContent = t.videosTitle;
            document.querySelector('#noVideosPublic').textContent = t.noVideos;
            
            // Section Projets
            document.querySelector('#projects .section-header h2').textContent = t.projectsTitle;
            document.querySelector('#projects .project-info h3').textContent = t.project1Title;
            document.querySelector('#projects .project-info p').textContent = t.project1Desc;
            
            // Section Publications
            document.querySelector('#publications .section-header h2').textContent = t.publicationsTitle;
            document.querySelector('#noPublicationsPublic').textContent = t.noPublications;
            
            // Section Contact
            document.querySelector('#contact h2').textContent = t.contactTitle;
            const contactItems = document.querySelectorAll('#contact .contact-item h3');
            contactItems[0].textContent = t.address;
            contactItems[1].textContent = t.phone;
            contactItems[2].textContent = t.email;
            document.querySelector('#contact .contact-item:nth-child(1) p').textContent = t.location;
            
            // Dashboard
            document.querySelector('#dashboard .page-title').textContent = t.dashboardTitle;
            const statCards = document.querySelectorAll('#dashboard .stat-card h3');
            statCards[0].textContent = t.totalVisitors;
            statCards[1].textContent = t.media;
            statCards[2].textContent = t.users;
            statCards[3].textContent = t.comments;
            
            // Media Manager
            document.querySelector('#simple-dashboard .simple-header h1').innerHTML = `<i class="fas fa-cloud-upload-alt"></i> ${t.mediaManagerTitle}`;
            document.querySelector('#simple-dashboard .simple-header p').textContent = t.mediaManagerSubtitle;
            document.querySelector('#simple-dashboard .dashboard-title').textContent = t.mediaManagerTitle;
            document.querySelector('#simple-dashboard .btn-import:nth-child(1)').innerHTML = `<i class="fas fa-file-import"></i> ${t.importJson}`;
            document.querySelector('#simple-dashboard .btn-import:nth-child(2)').innerHTML = `<i class="fas fa-file-export"></i> ${t.exportAll}`;
            document.querySelector('#simple-dashboard .btn-import:nth-child(3)').innerHTML = `<i class="fas fa-trash"></i> ${t.clearAll}`;
            
            // Sections du media manager
            document.querySelector('#gallerySection .section-title').innerHTML = `
                <div class="section-icon">
                    <i class="fas fa-images"></i>
                </div>
                ${t.photosGallery}
            `;
            document.querySelector('#gallerySection .btn-quick-add').innerHTML = `<i class="fas fa-cog"></i> ${t.manage}`;
            document.querySelector('#gallerySection .section-content p').innerHTML = `${lang === 'fr' ? 'Ajoutez des images à votre galerie. ' : 'أضف صور إلى معرضك. '}${t.supportedFormats}: JPG, PNG, GIF, WebP`;
            document.querySelector('#galleryEmpty').textContent = t.noImages;
            
            document.querySelector('#videosSection .section-title').innerHTML = `
                <div class="section-icon">
                    <i class="fas fa-video"></i>
                </div>
                ${t.videos}
            `;
            document.querySelector('#videosSection .btn-quick-add').innerHTML = `<i class="fas fa-cog"></i> ${t.manage}`;
            document.querySelector('#videosSection .section-content p').innerHTML = `${lang === 'fr' ? 'Importez vos vidéos. ' : 'استورد فيديوهاتك. '}${t.supportedFormats}: MP4, WebM, AVI, MOV, MKV`;
            document.querySelector('#videosEmpty').textContent = t.noVideosAdded;
            
            document.querySelector('#documentsSection .section-title').innerHTML = `
                <div class="section-icon">
                    <i class="fas fa-file-pdf"></i>
                </div>
                ${t.pdfDocuments}
            `;
            document.querySelector('#documentsSection .btn-quick-add').innerHTML = `<i class="fas fa-cog"></i> ${t.manage}`;
            document.querySelector('#documentsSection .section-content p').textContent = lang === 'fr' ? 'Téléversez vos documents PDF, rapports, publications' : 'ارفع مستندات PDF، تقارير، منشورات';
            document.querySelector('#documentsEmpty').textContent = t.noDocuments;
            
            document.querySelector('#textSection .section-title').innerHTML = `
                <div class="section-icon">
                    <i class="fas fa-file-alt"></i>
                </div>
                ${t.textContent}
            `;
            document.querySelector('#textSection .btn-quick-add').innerHTML = `<i class="fas fa-cog"></i> ${t.manage}`;
            document.querySelector('#textSection .section-content p').textContent = lang === 'fr' ? 'Ajoutez du texte (TXT, DOC, DOCX) ou écrivez directement' : 'أضف نص (TXT, DOC, DOCX) أو اكتب مباشرة';
            document.querySelector('#textEmpty').textContent = t.noTextContent;
            
            // Footer
            document.querySelector('#simple-dashboard .footer p').innerHTML = `<i class="fas fa-shield-alt"></i> ${t.filesSaved}`;
            document.getElementById('footerLogoTitle').textContent = 'أنسفال';
            document.getElementById('footerLogoSubtitle').textContent = t.heroSubtitle;
            document.querySelector('footer .footer-social h4').textContent = t.followUs;
            document.querySelector('footer .copyright p').innerHTML = `&copy; 2024 ${t.heroTitle}. ${t.rights}.`;
            
            // Mettre à jour les warnings de taille
            updateSizeWarnings();
        }

        function changeLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('ansfal_language', lang);
            
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const activeBtn = document.querySelector(`.lang-btn[onclick*="changeLanguage('${lang}')"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
            
            if (lang === 'ar') {
                document.body.classList.add('rtl');
            } else {
                document.body.classList.remove('rtl');
            }
            
            translatePage(lang);
        }

        // ==================== FONCTIONS D'AUTHENTIFICATION ====================
        function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            // Vérifier les identifiants
            if (username === 'admin' && password === '123456') {
                // Connexion réussie
                currentUser = {
                    id: 'admin',
                    username: 'admin',
                    name: 'Administrateur',
                    role: 'admin',
                    email: 'admin@ansfal.org',
                    createdAt: new Date().toISOString()
                };
                
                // Sauvegarder dans localStorage
                localStorage.setItem('ansfal_user', JSON.stringify(currentUser));
                
                // Afficher les infos utilisateur
                showUserInfo();
                
                // Activer le mode admin
                document.body.classList.add('admin-mode');
                document.getElementById('addBtn').style.display = 'flex';
                
                // Afficher le message de succès
                showAlert(translations[currentLanguage].loginSuccess, 'success');
                
                // Cacher le formulaire de connexion
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('userInfo').classList.remove('hidden');
                
                // Afficher le lien Gestionnaire de Médias
                document.querySelectorAll('.admin-only').forEach(el => {
                    el.style.display = 'block';
                });
                
                // Vérifier si c'est la première connexion
                const firstLogin = localStorage.getItem('ansfal_first_login');
                if (!firstLogin || firstLogin === 'true') {
                    localStorage.setItem('ansfal_first_login', 'false');
                    isFirstLogin = true;
                    showAlert(translations[currentLanguage].firstLoginPassword, 'info');
                    setTimeout(() => showPasswordModal(), 1500);
                }
                
                // Appliquer le logo sauvegardé
                applyLogo();
                
                // Recharger les sections du dashboard
                loadGalleryDashboard();
                loadVideosDashboard();
                loadDocumentsDashboard();
                loadTextDashboard();
                loadPublicGallery();
                loadPublicVideos();
                
            } else {
                // Échec de connexion
                showAlert(translations[currentLanguage].loginError, 'error');
                document.getElementById('password').value = '';
                document.getElementById('password').focus();
            }
        }

        function logout() {
            // Confirmation
            if (confirm(
                currentLanguage === 'fr' 
                    ? 'Voulez-vous vraiment vous déconnecter ?' 
                    : 'هل تريد حقاً تسجيل الخروج؟'
            )) {
                currentUser = null;
                localStorage.removeItem('ansfal_user');
                
                // Désactiver le mode admin
                document.body.classList.remove('admin-mode');
                document.getElementById('addBtn').style.display = 'none';
                
                // Afficher le formulaire de connexion
                document.getElementById('loginForm').classList.remove('hidden');
                document.getElementById('userInfo').classList.add('hidden');
                
                // Réinitialiser les champs
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                
                // Masquer le lien Gestionnaire de Médias
                document.querySelectorAll('.admin-only').forEach(el => {
                    el.style.display = 'none';
                });
                
                // Afficher le message
                showAlert(translations[currentLanguage].logoutSuccess, 'info');
                
                // Retourner à la page d'accueil
                showSection('home');
            }
        }

        function showUserInfo() {
            if (currentUser) {
                const roleNames = {
                    'admin': translations[currentLanguage].admin,
                    'webmaster': translations[currentLanguage].webmaster,
                    'editor': translations[currentLanguage].editor
                };
                
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('userRole').textContent = roleNames[currentUser.role] || currentUser.role;
                
                // Afficher la barre d'authentification
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('userInfo').classList.remove('hidden');
            }
        }

        // ==================== FONCTION D'ALERTE ====================
        function showAlert(message, type = 'info') {
            // Supprimer les alertes existantes
            const existingAlerts = document.querySelectorAll('.alert');
            existingAlerts.forEach(alert => {
                alert.style.opacity = '0';
                setTimeout(() => alert.remove(), 300);
            });
            
            // Créer l'alerte
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${type}`;
            alertDiv.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(alertDiv);
            
            // Supprimer automatiquement après 5 secondes
            setTimeout(() => {
                alertDiv.style.opacity = '0';
                setTimeout(() => alertDiv.remove(), 300);
            }, 5000);
        }

        // ==================== GESTION DES SECTIONS ====================
        function showSection(sectionId) {
            // Cacher toutes les sections
            document.querySelectorAll('section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Afficher la section demandée
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
            }
            
            // Si c'est le dashboard, charger les sections
            if (sectionId === 'dashboard') {
                loadDashboardSection('dashboard');
            }
            
            // Si c'est le dashboard simplifié, vérifier la connexion
            if (sectionId === 'simple-dashboard') {
                if (!currentUser) {
                    showAlert(translations[currentLanguage].pleaseLogin, 'error');
                    showSection('home');
                    return;
                }
                updatePreview();
            }
            
            // Si c'est la galerie, charger les images publiques
            if (sectionId === 'gallery') {
                loadPublicGallery();
            }
            
            // Si c'est les vidéos, charger les vidéos publiques
            if (sectionId === 'videos') {
                loadPublicVideos();
            }
            
            // Mettre à jour le menu actif
            document.querySelectorAll('nav a').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${sectionId}`) {
                    link.classList.add('active');
                }
            });
            
            // Faire défiler vers le haut
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function showDashboardSection(type) {
            // Cacher toutes les sections
            document.querySelectorAll('.dashboard-section-content').forEach(section => {
                section.classList.remove('active');
            });
            
            // Afficher la section demandée
            const targetSection = document.getElementById(`${type}Dashboard`);
            if (targetSection) {
                targetSection.classList.add('active');
            }
            
            // Mettre à jour le menu actif
            document.querySelectorAll('.sidebar-menu a').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-page') === type || link.getAttribute('data-section') === type) {
                    link.classList.add('active');
                }
            });
            
            // Charger le contenu spécifique
            if (type === 'image' || type === 'gallery') {
                loadGalleryDashboard();
            } else if (type === 'video' || type === 'videos') {
                loadVideosDashboard();
            } else if (type === 'pdf' || type === 'documents') {
                loadDocumentsDashboard();
            } else if (type === 'text') {
                loadTextDashboard();
            } else if (type === 'users') {
                loadUsersSection();
            } else if (type === 'settings') {
                updateStorageUsage();
            }
        }

        // ==================== CHARGEMENT DES UTILISATEURS ====================
        function loadUsers() {
            const defaultUsers = [
                {
                    id: 'admin',
                    username: 'admin',
                    password: '123456',
                    name: 'Administrateur',
                    email: 'admin@ansfal.org',
                    role: 'admin',
                    createdAt: new Date().toISOString()
                }
            ];
            
            const savedUsers = localStorage.getItem('ansfal_users');
            if (savedUsers) {
                return JSON.parse(savedUsers);
            } else {
                // Sauvegarder les utilisateurs par défaut
                localStorage.setItem('ansfal_users', JSON.stringify(defaultUsers));
                return defaultUsers;
            }
        }

        function loadUsersSection() {
            const users = loadUsers();
            const usersList = document.getElementById('usersList');
            
            if (!usersList) return;
            
            if (users.length === 0) {
                usersList.innerHTML = `
                    <div class="no-content">
                        <i class="fas fa-users"></i>
                        <p>${currentLanguage === 'fr' ? 'Aucun utilisateur' : 'لا يوجد مستخدمين'}</p>
                    </div>
                `;
                return;
            }
            
            let usersHTML = '<div class="items-grid">';
            
            users.forEach(user => {
                const roleNames = {
                    'admin': currentLanguage === 'fr' ? 'Admin' : 'مدير',
                    'webmaster': currentLanguage === 'fr' ? 'Webmaster' : 'ويب ماستر',
                    'editor': currentLanguage === 'fr' ? 'Éditeur' : 'محرر'
                };
                
                usersHTML += `
                    <div class="dashboard-item">
                        <div class="item-icon" style="background: ${user.role === 'admin' ? 'var(--danger)' : user.role === 'webmaster' ? 'var(--warning)' : 'var(--info)'};">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="item-info">
                            <h4>${user.name}</h4>
                            <small>${user.username} • ${roleNames[user.role] || user.role}</small>
                            <br>
                            <small style="color: #888; font-size: 0.8rem;">${user.email}</small>
                            <br>
                            <small style="color: #666; font-size: 0.7rem;">
                                ${currentLanguage === 'fr' ? 'Créé le:' : 'تم الإنشاء في:'} ${new Date(user.createdAt).toLocaleDateString(currentLanguage === 'fr' ? 'fr-FR' : 'ar-MA')}
                            </small>
                        </div>
                        <div class="item-actions">
                            <button class="btn-action" onclick="editUser('${user.id}')" title="${currentLanguage === 'fr' ? 'Modifier' : 'تعديل'}">
                                <i class="fas fa-edit"></i>
                            </button>
                            ${user.username !== 'admin' ? `
                                <button class="btn-action" onclick="deleteUser('${user.id}')" title="${currentLanguage === 'fr' ? 'Supprimer' : 'حذف'}" style="background: var(--danger);">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            });
            
            usersHTML += '</div>';
            usersList.innerHTML = usersHTML;
        }

        function deleteUser(userId) {
            if (!currentUser || currentUser.role !== 'admin') {
                showAlert(
                    currentLanguage === 'fr' 
                        ? 'Seuls les administrateurs peuvent supprimer des utilisateurs' 
                        : 'فقط المديرون يمكنهم حذف المستخدمين', 
                    'error'
                );
                return;
            }
            
            if (confirm(
                currentLanguage === 'fr' 
                    ? 'Voulez-vous vraiment supprimer cet utilisateur ?' 
                    : 'هل تريد حقاً حذف هذا المستخدم؟'
            )) {
                const users = loadUsers();
                const filteredUsers = users.filter(u => u.id !== userId);
                
                localStorage.setItem('ansfal_users', JSON.stringify(filteredUsers));
                
                showAlert(
                    currentLanguage === 'fr' 
                        ? 'Utilisateur supprimé avec succès' 
                        : 'تم حذف المستخدم بنجاح', 
                    'success'
                );
                
                loadUsersSection();
            }
        }

        // ==================== APPLIQUER LE LOGO ====================
        function applyLogo() {
            const savedLogo = localStorage.getItem('ansfal_logo');
            if (savedLogo) {
                const logoData = JSON.parse(savedLogo);
                
                // Mettre à jour l'icône
                const logoIcons = document.querySelectorAll('#logoIcon, #footerLogoIcon');
                logoIcons.forEach(icon => {
                    icon.className = logoData.iconClass || 'fas fa-hands-helping';
                    icon.style.color = logoData.color || '#1a6d2c';
                });
                
                // Mettre à jour le texte
                document.getElementById('logoTitle').textContent = logoData.title || 'أنسفال';
                document.getElementById('logoSubtitle').textContent = logoData.subtitle || 'جمعية التعاون والتنمية والبيئة';
                document.getElementById('footerLogoTitle').textContent = logoData.title || 'أنسفال';
                document.getElementById('footerLogoSubtitle').textContent = logoData.subtitle || 'جمعية التعاون والتنمية والبيئة';
            }
        }

        // ==================== BOUTONS ACCEPTER/VALIDER ====================
        function acceptUpload() {
            // Vérifier qu'il y a des fichiers
            if (selectedFiles.length === 0) {
                showAlert(translations[currentLanguage].selectFile, 'error');
                return;
            }
            
            // Cacher "Accepter" et montrer "Valider"
            document.getElementById('acceptBtn').style.display = 'none';
            document.getElementById('validateBtn').style.display = 'flex';
            
            // Mettre en surbrillance les fichiers
            const fileItems = document.querySelectorAll('.file-item');
            fileItems.forEach(item => {
                item.style.border = '2px solid var(--success)';
                item.style.boxShadow = '0 0 10px rgba(76, 175, 80, 0.3)';
            });
            
            showAlert(
                currentLanguage === 'fr' 
                    ? 'Fichiers acceptés. Cliquez sur "Valider" pour terminer l\'upload.' 
                    : 'تم قبول الملفات. انقر على "تأكيد" لإنهاء التحميل.',
                'info'
            );
        }

        function validateAndUpload() {
            // Désactiver le bouton pendant l'upload
            document.getElementById('validateBtn').disabled = true;
            
            // Lancer l'upload
            if (uploadMode === 'pc' || uploadMode === 'url') {
                uploadFiles();
            }
        }

        // ==================== CHOIX DU MODE D'UPLOAD ====================
        function selectUploadMode(mode) {
            uploadMode = mode;
            
            // Mettre à jour les boutons
            document.getElementById('uploadFromPC').classList.toggle('active', mode === 'pc');
            document.getElementById('uploadFromURL').classList.toggle('active', mode === 'url');
            
            // Afficher/masquer les zones appropriées
            const pcUploadArea = document.getElementById('pcUploadArea');
            const urlUploadArea = document.getElementById('urlUploadArea');
            const previewTitle = document.getElementById('previewTitle');
            const uploadBtn = document.getElementById('uploadBtn');
            
            if (mode === 'pc') {
                pcUploadArea.style.display = 'block';
                urlUploadArea.classList.remove('active');
                previewTitle.textContent = translations[currentLanguage].selectedFiles;
                uploadBtn.style.display = 'block';
            } else {
                pcUploadArea.style.display = 'none';
                urlUploadArea.classList.add('active');
                previewTitle.textContent = currentLanguage === 'fr' ? 'Liens ajoutés' : 'الروابط المضافة';
                uploadBtn.style.display = 'none';
            }
            
            // Réinitialiser la prévisualisation
            updateUrlPreview();
        }

        // ==================== AJOUT D'URL ====================
        function addUrlMedia() {
            const url = document.getElementById('mediaUrl').value.trim();
            const title = document.getElementById('mediaTitle').value.trim();
            
            if (!url) {
                showAlert(translations[currentLanguage].invalidUrl, 'error');
                return;
            }
            
            // Vérifier si c'est une URL valide
            try {
                new URL(url);
            } catch (e) {
                showAlert(translations[currentLanguage].invalidUrl, 'error');
                return;
            }
            
            // Déterminer le type de média
            let type = 'url';
            let extension = 'url';
            let icon = 'fas fa-link';
            
            if (url.includes('i.imgur.com') || url.includes('imgur.com')) {
                type = 'image';
                extension = 'jpg';
                icon = 'fas fa-image';
            } else if (url.includes('youtube.com') || url.includes('youtu.be')) {
                type = 'video';
                extension = 'mp4';
                icon = 'fas fa-video';
            } else if (url.match(/\.(jpg|jpeg|png|gif|webp|bmp)$/i)) {
                type = 'image';
                extension = url.split('.').pop().toLowerCase();
                icon = 'fas fa-image';
            } else if (url.match(/\.(mp4|webm|avi|mov|mkv)$/i)) {
                type = 'video';
                extension = url.split('.').pop().toLowerCase();
                icon = 'fas fa-video';
            }
            
            // Créer l'objet média
            const mediaItem = {
                id: Date.now(),
                url: url,
                title: title || (type === 'image' ? 'صورة من Imgur' : type === 'video' ? 'فيديو من YouTube' : 'رابط خارجي'),
                type: type,
                extension: extension,
                date: new Date().toISOString(),
                source: 'url'
            };
            
            // Ajouter au tableau selectedFiles
            selectedFiles.push(mediaItem);
            
            // Mettre à jour la prévisualisation
            updateUrlPreview();
            
            // Réinitialiser les champs
            document.getElementById('mediaUrl').value = '';
            document.getElementById('mediaTitle').value = '';
            
            showAlert(translations[currentLanguage].urlAdded, 'success');
        }

        function updateUrlPreview() {
            const filesGrid = document.getElementById('filesGrid');
            const noFiles = document.getElementById('noFiles');
            
            filesGrid.innerHTML = '';
            
            if (selectedFiles.length === 0) {
                noFiles.style.display = 'block';
                return;
            }
            
            noFiles.style.display = 'none';
            
            selectedFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                
                const icon = file.icon || FILE_ICONS[file.type] || 'fas fa-link';
                const title = file.title || file.url.substring(0, 30);
                
                fileItem.innerHTML = `
                    <div class="file-icon">
                        <i class="${icon}"></i>
                    </div>
                    <div class="file-name" title="${file.url}">
                        ${title}
                    </div>
                    <div class="file-size">
                        ${file.source === 'url' ? 'رابط خارجي' : formatFileSize(file.size)}
                    </div>
                    <button class="remove-file" onclick="removeFile(${index})">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                filesGrid.appendChild(fileItem);
            });
        }

        // ==================== FONCTIONS UTILITAIRES ====================
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        function simulateUpload(index, total, progressFill, progressText) {
            return new Promise(resolve => {
                const duration = 1000; // 1 seconde par fichier
                const interval = 100;
                const steps = duration / interval;
                let currentStep = 0;
                
                const timer = setInterval(() => {
                    currentStep++;
                    const currentProgress = ((index / total) * 100) + ((currentStep / steps) * (100 / total));
                    progressFill.style.width = `${currentProgress}%`;
                    progressText.textContent = `${Math.round(currentProgress)}%`;
                    
                    if (currentStep >= steps) {
                        clearInterval(timer);
                        resolve();
                    }
                }, interval);
            });
        }

        function updateSizeWarnings() {
            const maxSizes = {
                'image': '20 ميجابايت',
                'video': '100 ميجابايت',
                'pdf': '50 ميجابايت',
                'text': '10 ميجابايت'
            };
            
            for (const type in maxSizes) {
                const warning = document.getElementById(`${type}SizeWarning`);
                if (warning) {
                    warning.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${currentLanguage === 'fr' ? 'Taille max:' : 'الحد الأقصى:'} ${maxSizes[type]} ${currentLanguage === 'fr' ? 'par fichier' : 'لكل ملف'}`;
                }
            }
            
            const modalWarning = document.getElementById('modalSizeWarning');
            if (modalWarning && currentUploadType) {
                modalWarning.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${currentLanguage === 'fr' ? 'Taille max:' : 'الحد الأقصى:'} ${maxSizes[currentUploadType]} ${currentLanguage === 'fr' ? 'par fichier' : 'لكل ملف'}`;
            }
        }

        // ==================== FONCTIONS MODALES ====================
        function showUploadModal(type) {
            if (!currentUser) {
                showAlert(translations[currentLanguage].pleaseLogin, 'error');
                return;
            }
            
            currentUploadType = type;
            uploadMode = 'pc'; // Reset to PC upload by default
            
            // Mettre à jour l'interface selon le type
            const t = translations[currentLanguage];
            document.getElementById('uploadModalTitle').innerHTML = 
                `<i class="fas fa-cloud-upload-alt"></i> ${t.uploadFiles}`;
            
            // Mettre à jour les choix d'upload
            document.getElementById('uploadPcTitle').textContent = t.uploadFromPC;
            document.getElementById('uploadPcDesc').textContent = t.uploadFromPCDesc;
            document.getElementById('uploadUrlTitle').textContent = t.uploadFromURL;
            document.getElementById('uploadUrlDesc').textContent = t.uploadFromURLDesc;
            
            // Configurer selon le type
            if (type === 'text') {
                showTextModal();
                return;
            }
            
            // Réinitialiser l'interface
            resetUploadInterface();
            
            // Afficher la modale
            document.getElementById('uploadModal').classList.add('active');
            
            // Initialiser les boutons
            document.getElementById('acceptBtn').style.display = 'flex';
            document.getElementById('validateBtn').style.display = 'none';
            document.getElementById('validateBtn').disabled = false;
            
            // Initialiser le drag & drop
            setupFileInput();
        }

        function resetUploadInterface() {
            selectedFiles = [];
            uploadMode = 'pc';
            document.getElementById('filesGrid').innerHTML = '';
            document.getElementById('noFiles').style.display = 'block';
            document.getElementById('uploadProgress').style.display = 'none';
            document.getElementById('uploadSuccess').style.display = 'none';
            document.getElementById('actionButtons').style.display = 'flex';
            document.getElementById('progressFill').style.width = '0%';
            document.getElementById('progressText').textContent = '0%';
            
            // Réinitialiser les boutons Accepter/Valider
            document.getElementById('acceptBtn').style.display = 'flex';
            document.getElementById('validateBtn').style.display = 'none';
            document.getElementById('validateBtn').disabled = false;
            
            // Réinitialiser les boutons de choix
            document.getElementById('uploadFromPC').classList.add('active');
            document.getElementById('uploadFromURL').classList.remove('active');
            document.getElementById('pcUploadArea').style.display = 'block';
            document.getElementById('urlUploadArea').classList.remove('active');
            document.getElementById('mediaUrl').value = '';
            document.getElementById('mediaTitle').value = '';
            
            // Réinitialiser la surbrillance des fichiers
            const fileItems = document.querySelectorAll('.file-item');
            fileItems.forEach(item => {
                item.style.border = '2px solid transparent';
                item.style.boxShadow = '0 3px 10px rgba(0,0,0,0.08)';
            });
        }

        function hideUploadModal() {
            document.getElementById('uploadModal').classList.remove('active');
            resetUploadInterface();
            
            // Réinitialiser les boutons
            document.getElementById('acceptBtn').style.display = 'flex';
            document.getElementById('validateBtn').style.display = 'none';
            document.getElementById('validateBtn').disabled = false;
            
            // Réinitialiser la surbrillance
            const fileItems = document.querySelectorAll('.file-item');
            fileItems.forEach(item => {
                item.style.border = '2px solid transparent';
                item.style.boxShadow = '0 3px 10px rgba(0,0,0,0.08)';
            });
        }

        function showSuccessMessage(count) {
            const successDiv = document.getElementById('uploadSuccess');
            const successMessage = document.getElementById('successMessage');
            const actionButtons = document.getElementById('actionButtons');
            
            successMessage.textContent = currentLanguage === 'fr' 
                ? `${count} fichier(s) téléversé(s) avec succès !` 
                : `تم رفع ${count} ملف بنجاح!`;
            
            successDiv.style.display = 'block';
            actionButtons.style.display = 'none';
        }

        function setupFileInput() {
            const fileInput = document.getElementById('fileInput');
            const uploadArea = document.querySelector('.upload-area');
            
            if (!fileInput || !uploadArea) return;
            
            // Configurer l'input file
            fileInput.accept = ACCEPTED_FILES[currentUploadType] || '*';
            fileInput.onchange = handleFileSelect;
            
            // Drag & drop
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('drag-over');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('drag-over');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('drag-over');
                
                if (e.dataTransfer.files.length) {
                    handleFiles(e.dataTransfer.files);
                }
            });
            
            // Click sur la zone d'upload
            uploadArea.addEventListener('click', () => {
                fileInput.click();
            });
            
            // Click sur le bouton browse
            const browseBtn = uploadArea.querySelector('.btn-browse');
            if (browseBtn) {
                browseBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    fileInput.click();
                });
            }
        }

        function handleFileSelect(e) {
            const files = e.target.files;
            handleFiles(files);
        }

        function handleFiles(files) {
            const maxSize = MAX_FILE_SIZES[currentUploadType] || 20 * 1024 * 1024;
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                // Vérifier la taille
                if (file.size > maxSize) {
                    showAlert(
                        currentLanguage === 'fr' 
                            ? `Le fichier ${file.name} dépasse la taille maximale de ${formatFileSize(maxSize)}` 
                            : `الملف ${file.name} يتجاوز الحد الأقصى للحجم ${formatFileSize(maxSize)}`,
                        'error'
                    );
                    continue;
                }
                
                // Vérifier le type
                const fileExtension = file.name.split('.').pop().toLowerCase();
                const acceptedExtensions = ACCEPTED_FILES[currentUploadType]?.split(',').map(ext => ext.replace('.', '')) || [];
                
                if (acceptedExtensions.length > 0 && !acceptedExtensions.includes(fileExtension)) {
                    showAlert(
                        currentLanguage === 'fr' 
                            ? `Le fichier ${file.name} n'est pas un format valide pour cette section` 
                            : `الملف ${file.name} ليس بصيغة صالحة لهذا القسم`,
                        'error'
                    );
                    continue;
                }
                
                // Ajouter le fichier avec un ID unique
                file.id = Date.now() + i;
                selectedFiles.push(file);
            }
            
            // Afficher le bouton Accepter quand des fichiers sont ajoutés
            if (selectedFiles.length > 0) {
                document.getElementById('acceptBtn').style.display = 'flex';
                document.getElementById('validateBtn').style.display = 'none';
            }
            
            updateFilePreview();
        }

        function updateFilePreview() {
            const filesGrid = document.getElementById('filesGrid');
            const noFiles = document.getElementById('noFiles');
            
            filesGrid.innerHTML = '';
            
            if (selectedFiles.length === 0) {
                noFiles.style.display = 'block';
                return;
            }
            
            noFiles.style.display = 'none';
            
            selectedFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                
                let icon = FILE_ICONS.default;
                if (currentUploadType === 'image') icon = FILE_ICONS.image;
                else if (currentUploadType === 'video') icon = FILE_ICONS.video;
                else if (currentUploadType === 'pdf') icon = FILE_ICONS.pdf;
                else if (file.name.match(/\.(txt|doc|docx|rtf)$/i)) {
                    const ext = file.name.split('.').pop().toLowerCase();
                    icon = FILE_ICONS[ext] || FILE_ICONS.default;
                }
                
                fileItem.innerHTML = `
                    <div class="file-icon">
                        <i class="${icon}"></i>
                    </div>
                    <div class="file-name" title="${file.name}">
                        ${file.name.length > 20 ? file.name.substring(0, 17) + '...' : file.name}
                    </div>
                    <div class="file-size">
                        ${formatFileSize(file.size)}
                    </div>
                    <button class="remove-file" onclick="removeFile(${index})">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                filesGrid.appendChild(fileItem);
            });
        }

        function removeFile(index) {
            selectedFiles.splice(index, 1);
            
            if (uploadMode === 'pc') {
                updateFilePreview();
            } else {
                updateUrlPreview();
            }
            
            // Si plus de fichiers, cacher le bouton Accepter
            if (selectedFiles.length === 0) {
                document.getElementById('acceptBtn').style.display = 'flex';
                document.getElementById('validateBtn').style.display = 'none';
            }
        }

        async function uploadFiles() {
            if (!currentUser) {
                showAlert(translations[currentLanguage].pleaseLogin, 'error');
                return;
            }
            
            if (uploadMode === 'pc' && selectedFiles.length === 0) {
                showAlert(translations[currentLanguage].selectFile, 'error');
                return;
            }
            
            if (uploadMode === 'url') {
                // Pour les URLs, on traite directement
                if (selectedFiles.length === 0) {
                    showAlert(translations[currentLanguage].selectFile, 'error');
                    return;
                }
                
                // Sauvegarder les URLs directement
                saveFilesToLocalStorage(selectedFiles);
                
                // Afficher le message de succès
                showSuccessMessage(selectedFiles.length);
                
                // Recharger les sections
                if (currentUploadType === 'image') {
                    loadGalleryDashboard();
                    loadPublicGallery();
                } else if (currentUploadType === 'video') {
                    loadVideosDashboard();
                    loadPublicVideos();
                }
                
                return;
            }
            
            // Désactiver le bouton d'upload
            document.getElementById('validateBtn').disabled = true;
            
            // Afficher la barre de progression
            const progressDiv = document.getElementById('uploadProgress');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            progressDiv.style.display = 'block';
            progressFill.style.width = '0%';
            progressText.textContent = '0%';
            
            let uploadedFiles = [];
            
            for (let i = 0; i < selectedFiles.length; i++) {
                const file = selectedFiles[i];
                
                try {
                    // Simuler un téléversement avec progression
                    await simulateUpload(i, selectedFiles.length, progressFill, progressText);
                    
                    if (file.source === 'url') {
                        // Pour les URLs
                        uploadedFiles.push({
                            id: file.id,
                            name: file.title,
                            type: file.type,
                            url: file.url,
                            date: file.date,
                            extension: file.extension,
                            source: 'url'
                        });
                    } else {
                        // Pour les fichiers locaux
                        const base64 = await fileToBase64(file);
                        uploadedFiles.push({
                            id: file.id,
                            name: file.name,
                            type: currentUploadType,
                            size: file.size,
                            base64: base64,
                            date: new Date().toISOString(),
                            extension: file.name.split('.').pop().toLowerCase()
                        });
                    }
                    
                } catch (error) {
                    console.error('Erreur:', error);
                    showAlert(`${currentLanguage === 'fr' ? 'Erreur lors du traitement de' : 'خطأ أثناء معالجة'} ${file.name || file.url}`, 'error');
                }
            }
            
            // Sauvegarder dans le localStorage
            if (uploadedFiles.length > 0) {
                saveFilesToLocalStorage(uploadedFiles);
                
                // Mettre à jour l'affichage
                updatePreview();
                
                // Afficher le message de succès
                showSuccessMessage(uploadedFiles.length);
                
                // Recharger la section du dashboard
                if (currentUploadType === 'image') {
                    loadGalleryDashboard();
                    loadPublicGallery();
                } else if (currentUploadType === 'video') {
                    loadVideosDashboard();
                    loadPublicVideos();
                }
            }
            
            // Réactiver le bouton Valider
            document.getElementById('validateBtn').disabled = false;
            document.getElementById('acceptBtn').style.display = 'flex';
            document.getElementById('validateBtn').style.display = 'none';
            
            // Réinitialiser la surbrillance des fichiers
            const fileItems = document.querySelectorAll('.file-item');
            fileItems.forEach(item => {
                item.style.border = '2px solid transparent';
                item.style.boxShadow = '0 3px 10px rgba(0,0,0,0.08)';
            });
        }

        function saveFilesToLocalStorage(files) {
            const existingFiles = JSON.parse(localStorage.getItem(`ansfal_${currentUploadType}`) || '[]');
            const allFiles = [...existingFiles, ...files];
            
            // Limiter le nombre de fichiers
            const maxFiles = currentUploadType === 'video' ? 20 : 50;
            if (allFiles.length > maxFiles) {
                allFiles.splice(0, allFiles.length - maxFiles);
            }
            
            localStorage.setItem(`ansfal_${currentUploadType}`, JSON.stringify(allFiles));
        }

        // ==================== INITIALISATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            // Initialiser le compteur de visiteurs
            updateVisitorCount();
            
            // Vérifier la langue sauvegardée
            const savedLang = localStorage.getItem('ansfal_language');
            if (savedLang) {
                changeLanguage(savedLang);
            } else {
                changeLanguage('fr');
            }
            
            // Vérifier l'utilisateur connecté
            const savedUser = localStorage.getItem('ansfal_user');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showUserInfo();
                document.body.classList.add('admin-mode');
                document.getElementById('addBtn').style.display = 'flex';
                
                // Appliquer le logo sauvegardé
                applyLogo();
            } else {
                // Cacher le lien Gestionnaire de Médias si non connecté
                document.querySelectorAll('.admin-only').forEach(el => {
                    el.style.display = 'none';
                });
            }
            
            // Initialiser le menu
            document.querySelectorAll('nav a').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href').substring(1);
                    showSection(targetId);
                    
                    document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // Initialiser WhatsApp
            const phone = "+212612345678";
            const message = currentLanguage === 'fr' 
                ? "Bonjour, je voudrais des informations sur l'association أنسفال" 
                : "مرحباً، أود الحصول على معلومات حول جمعية أنسفال";
            const whatsappUrl = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
            document.getElementById('whatsappBtn').href = whatsappUrl;
            
            // Initialiser le bouton d'ajout
            document.getElementById('addBtn').addEventListener('click', function() {
                if (currentUser) {
                    showUploadModal('image');
                } else {
                    showAlert(translations[currentLanguage].pleaseLogin, 'error');
                }
            });
            
            // Afficher la section d'accueil par défaut
            showSection('home');
            
            // Initialiser le drag & drop
            setupFileInput();
            
            // Charger les galeries publiques
            loadPublicGallery();
            loadPublicVideos();
        });

        // ==================== FONCTIONS MANQUANTES ESSENTIELLES ====================
        function updateVisitorCount() {
            // Simuler des données de visiteurs
            let totalVisitors = parseInt(localStorage.getItem('ansfal_total_visitors') || '0');
            totalVisitors++;
            localStorage.setItem('ansfal_total_visitors', totalVisitors.toString());
            
            const onlineVisitors = Math.floor(Math.random() * 50) + 1;
            const lastVisit = new Date().toLocaleString();
            
            document.getElementById('totalVisitors').textContent = totalVisitors;
            document.getElementById('onlineVisitors').textContent = onlineVisitors;
            document.getElementById('lastVisit').textContent = lastVisit;
            
            // Mettre à jour les statistiques du dashboard
            document.getElementById('totalVisitorsStat').textContent = totalVisitors;
        }

        // ==================== CHARGEMENT DES GALERIES PUBLIQUES ====================
        function loadPublicGallery() {
            const images = JSON.parse(localStorage.getItem('ansfal_image') || '[]');
            const galleryPublic = document.getElementById('publicGallery');
            const noGallery = document.getElementById('noGalleryPublic');
            
            if (!galleryPublic) return;
            
            if (images.length === 0) {
                noGallery.style.display = 'block';
                return;
            }
            
            noGallery.style.display = 'none';
            let galleryHTML = '';
            
            images.forEach((image, index) => {
                if (image.base64) {
                    galleryHTML += `
                        <div class="gallery-public-item" onclick="viewFile('image', ${index})">
                            <img src="${image.base64}" alt="${image.name || 'Image'}" loading="lazy">
                        </div>
                    `;
                } else if (image.url) {
                    galleryHTML += `
                        <div class="gallery-public-item" onclick="viewFile('image', ${index})">
                            <img src="${image.url}" alt="${image.name || 'Image'}" loading="lazy">
                        </div>
                    `;
                }
            });
            
            galleryPublic.innerHTML = galleryHTML;
        }

        function loadPublicVideos() {
            const videos = JSON.parse(localStorage.getItem('ansfal_video') || '[]');
            const videosPublic = document.getElementById('publicVideos');
            const noVideos = document.getElementById('noVideosPublic');
            
            if (!videosPublic) return;
            
            if (videos.length === 0) {
                noVideos.style.display = 'block';
                return;
            }
            
            noVideos.style.display = 'none';
            let videosHTML = '';
            
            videos.forEach((video, index) => {
                if (video.url) {
                    // Vérifier si c'est une URL YouTube
                    if (video.url.includes('youtube.com') || video.url.includes('youtu.be')) {
                        let videoId = '';
                        if (video.url.includes('youtube.com/embed/')) {
                            videoId = video.url.split('youtube.com/embed/')[1];
                        } else if (video.url.includes('youtu.be/')) {
                            videoId = video.url.split('youtu.be/')[1];
                        } else if (video.url.includes('youtube.com/watch?v=')) {
                            videoId = video.url.split('v=')[1].split('&')[0];
                        }
                        
                        if (videoId) {
                            videosHTML += `
                                <div class="video-public-item">
                                    <div class="youtube-embed">
                                        <iframe 
                                            src="https://www.youtube.com/embed/${videoId}" 
                                            frameborder="0" 
                                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                            allowfullscreen>
                                        </iframe>
                                    </div>
                                </div>
                            `;
                        }
                    } else {
                        // Vidéo directe
                        videosHTML += `
                            <div class="video-public-item" onclick="viewFile('video', ${index})">
                                <video style="width: 100%; height: 100%; object-fit: cover;">
                                    <source src="${video.url}" type="video/mp4">
                                    ${currentLanguage === 'fr' ? 'Votre navigateur ne supporte pas la lecture vidéo.' : 'متصفحك لا يدعم تشغيل الفيديو.'}
                                </video>
                            </div>
                        `;
                    }
                } else if (video.base64) {
                    videosHTML += `
                        <div class="video-public-item" onclick="viewFile('video', ${index})">
                            <video style="width: 100%; height: 100%; object-fit: cover;">
                                <source src="${video.base64}" type="video/mp4">
                                ${currentLanguage === 'fr' ? 'Votre navigateur ne supporte pas la lecture vidéo.' : 'متصفحك لا يدعم تشغيل الفيديو.'}
                            </video>
                        </div>
                    `;
                }
            });
            
            videosPublic.innerHTML = videosHTML;
        }

        // ==================== CHARGEMENT DASHBOARD ====================
        function loadGalleryDashboard() {
            const images = JSON.parse(localStorage.getItem('ansfal_image') || '[]');
            const galleryList = document.getElementById('galleryList');
            
            if (!galleryList) return;
            
            if (images.length === 0) {
                galleryList.innerHTML = `
                    <div class="no-content">
                        <i class="fas fa-images"></i>
                        <p>${currentLanguage === 'fr' ? 'Aucune image' : 'لا توجد صور'}</p>
                    </div>
                `;
                return;
            }
            
            let galleryHTML = '';
            
            images.forEach((image, index) => {
                galleryHTML += `
                    <div class="dashboard-item">
                        <div class="item-icon" style="background: var(--primary);">
                            <i class="fas fa-image"></i>
                        </div>
                        <div class="item-info">
                            <h4>${image.name || 'Image ' + (index + 1)}</h4>
                            <small>${image.extension.toUpperCase()} • ${new Date(image.date).toLocaleDateString()}</small>
                        </div>
                        <div class="item-actions">
                            <button class="btn-action" onclick="viewFile('image', ${index})" title="${currentLanguage === 'fr' ? 'Voir' : 'عرض'}">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-action" onclick="deleteFile('image', ${index})" title="${currentLanguage === 'fr' ? 'Supprimer' : 'حذف'}" style="background: var(--danger);">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            galleryList.innerHTML = galleryHTML;
        }

        function loadVideosDashboard() {
            const videos = JSON.parse(localStorage.getItem('ansfal_video') || '[]');
            const videosList = document.getElementById('videosList');
            
            if (!videosList) return;
            
            if (videos.length === 0) {
                videosList.innerHTML = `
                    <div class="no-content">
                        <i class="fas fa-video"></i>
                        <p>${currentLanguage === 'fr' ? 'Aucune vidéo' : 'لا توجد فيديوهات'}</p>
                    </div>
                `;
                return;
            }
            
            let videosHTML = '';
            
            videos.forEach((video, index) => {
                videosHTML += `
                    <div class="dashboard-item">
                        <div class="item-icon" style="background: var(--info);">
                            <i class="fas fa-video"></i>
                        </div>
                        <div class="item-info">
                            <h4>${video.name || 'Vidéo ' + (index + 1)}</h4>
                            <small>${video.extension.toUpperCase()} • ${new Date(video.date).toLocaleDateString()}</small>
                        </div>
                        <div class="item-actions">
                            <button class="btn-action" onclick="viewFile('video', ${index})" title="${currentLanguage === 'fr' ? 'Voir' : 'عرض'}">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-action" onclick="deleteFile('video', ${index})" title="${currentLanguage === 'fr' ? 'Supprimer' : 'حذف'}" style="background: var(--danger);">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            videosList.innerHTML = videosHTML;
        }

        function loadDocumentsDashboard() {
            const documents = JSON.parse(localStorage.getItem('ansfal_pdf') || '[]');
            const documentsList = document.getElementById('documentsList');
            
            if (!documentsList) return;
            
            if (documents.length === 0) {
                documentsList.innerHTML = `
                    <div class="no-content">
                        <i class="fas fa-file-pdf"></i>
                        <p>${currentLanguage === 'fr' ? 'Aucun document' : 'لا توجد مستندات'}</p>
                    </div>
                `;
                return;
            }
            
            let documentsHTML = '';
            
            documents.forEach((doc, index) => {
                documentsHTML += `
                    <div class="dashboard-item">
                        <div class="item-icon" style="background: var(--warning);">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div class="item-info">
                            <h4>${doc.name || 'Document ' + (index + 1)}</h4>
                            <small>${doc.extension.toUpperCase()} • ${new Date(doc.date).toLocaleDateString()}</small>
                        </div>
                        <div class="item-actions">
                            <button class="btn-action" onclick="viewFile('pdf', ${index})" title="${currentLanguage === 'fr' ? 'Voir' : 'عرض'}">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-action" onclick="deleteFile('pdf', ${index})" title="${currentLanguage === 'fr' ? 'Supprimer' : 'حذف'}" style="background: var(--danger);">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            documentsList.innerHTML = documentsHTML;
        }

        function loadTextDashboard() {
            const texts = JSON.parse(localStorage.getItem('ansfal_text') || '[]');
            const textList = document.getElementById('textList');
            
            if (!textList) return;
            
            if (texts.length === 0) {
                textList.innerHTML = `
                    <div class="no-content">
                        <i class="fas fa-file-alt"></i>
                        <p>${currentLanguage === 'fr' ? 'Aucun texte' : 'لا توجد نصوص'}</p>
                    </div>
                `;
                return;
            }
            
            let textHTML = '';
            
            texts.forEach((text, index) => {
                textHTML += `
                    <div class="dashboard-item">
                        <div class="item-icon" style="background: var(--success);">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="item-info">
                            <h4>${text.title || 'Texte ' + (index + 1)}</h4>
                            <small>${text.content.substring(0, 50)}...</small>
                        </div>
                        <div class="item-actions">
                            <button class="btn-action" onclick="viewText(${index})" title="${currentLanguage === 'fr' ? 'Voir' : 'عرض'}">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-action" onclick="deleteText(${index})" title="${currentLanguage === 'fr' ? 'Supprimer' : 'حذف'}" style="background: var(--danger);">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            textList.innerHTML = textHTML;
        }

        // ==================== GESTION DES FICHIERS ====================
        function deleteFile(type, index) {
            // Vérifier si l'utilisateur est connecté
            if (!currentUser) {
                showAlert(
                    currentLanguage === 'fr' 
                        ? 'Veuillez vous connecter pour supprimer des fichiers' 
                        : 'يرجى تسجيل الدخول لحذف الملفات', 
                    'error'
                );
                return;
            }
            
            // Vérifier les permissions selon le rôle
            if (currentUser.role !== 'admin' && currentUser.role !== 'webmaster') {
                showAlert(
                    currentLanguage === 'fr' 
                        ? 'Vous n\'avez pas les permissions nécessaires' 
                        : 'ليس لديك الصلاحيات اللازمة', 
                    'error'
                );
                return;
            }
            
            const confirmationMessage = currentLanguage === 'fr' 
                ? 'Voulez-vous vraiment supprimer ce fichier ?' 
                : 'هل تريد حقاً حذف هذا الملف؟';
            
            if (!confirm(confirmationMessage)) return;
            
            const files = JSON.parse(localStorage.getItem(`ansfal_${type}`) || '[]');
            
            if (index >= 0 && index < files.length) {
                files.splice(index, 1);
                localStorage.setItem(`ansfal_${type}`, JSON.stringify(files));
                
                showAlert(
                    currentLanguage === 'fr' ? 'Fichier supprimé avec succès' : 'تم حذف الملف بنجاح', 
                    'success'
                );
                
                // Recharger les sections
                if (type === 'image') {
                    loadGalleryDashboard();
                    loadPublicGallery();
                } else if (type === 'video') {
                    loadVideosDashboard();
                    loadPublicVideos();
                } else if (type === 'pdf') {
                    loadDocumentsDashboard();
                }
                
                // Mettre à jour les aperçus
                updatePreview();
            }
        }

        // ==================== VISUALISATION DES FICHIERS ====================
        function viewFile(type, index) {
            const files = JSON.parse(localStorage.getItem(`ansfal_${type}`) || '[]');
            const file = files[index];
            
            if (!file) {
                showAlert(currentLanguage === 'fr' ? 'Fichier non trouvé' : 'الملف غير موجود', 'error');
                return;
            }
            
            // Créer le contenu du visualiseur
            const viewer = document.getElementById('fileViewer');
            const viewerTitle = document.getElementById('viewerTitle');
            const viewerContent = document.getElementById('viewerContent');
            
            viewerTitle.textContent = file.name || file.title || `Fichier ${type}`;
            
            if (type === 'image') {
                if (file.url) {
                    viewerContent.innerHTML = `<img src="${file.url}" alt="${file.name || 'Image'}" style="max-width: 100%; max-height: 70vh; border-radius: 10px;">`;
                } else if (file.base64) {
                    viewerContent.innerHTML = `<img src="${file.base64}" alt="${file.name || 'Image'}" style="max-width: 100%; max-height: 70vh; border-radius: 10px;">`;
                }
            } else if (type === 'video') {
                if (file.url) {
                    // Vérifier si c'est une URL YouTube
                    if (file.url.includes('youtube.com') || file.url.includes('youtu.be')) {
                        let videoId = '';
                        if (file.url.includes('youtube.com/embed/')) {
                            videoId = file.url.split('youtube.com/embed/')[1];
                        } else if (file.url.includes('youtu.be/')) {
                            videoId = file.url.split('youtu.be/')[1];
                        } else if (file.url.includes('youtube.com/watch?v=')) {
                            videoId = file.url.split('v=')[1].split('&')[0];
                        }
                        
                        if (videoId) {
                            viewerContent.innerHTML = `
                                <iframe 
                                    width="100%" 
                                    height="500" 
                                    src="https://www.youtube.com/embed/${videoId}" 
                                    frameborder="0" 
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                    allowfullscreen
                                    style="border-radius: 10px;">
                                </iframe>`;
                        } else {
                            viewerContent.innerHTML = `<p style="color: white; text-align: center;">${currentLanguage === 'fr' ? 'URL YouTube invalide' : 'رابط يوتيوب غير صالح'}</p>`;
                        }
                    } else {
                        viewerContent.innerHTML = `
                            <video controls style="max-width: 100%; max-height: 70vh; border-radius: 10px;">
                                <source src="${file.url || file.base64}" type="video/mp4">
                                ${currentLanguage === 'fr' ? 'Votre navigateur ne supporte pas la lecture vidéo.' : 'متصفحك لا يدعم تشغيل الفيديو.'}
                            </video>`;
                    }
                } else if (file.base64) {
                    viewerContent.innerHTML = `
                        <video controls style="max-width: 100%; max-height: 70vh; border-radius: 10px;">
                            <source src="${file.base64}" type="video/mp4">
                            ${currentLanguage === 'fr' ? 'Votre navigateur ne supporte pas la lecture vidéo.' : 'متصفحك لا يدعم تشغيل الفيديو.'}
                        </video>`;
                }
            } else if (type === 'pdf') {
                if (file.url) {
                    viewerContent.innerHTML = `<iframe src="${file.url}" style="width: 100%; height: 70vh; border: none; border-radius: 10px;"></iframe>`;
                } else if (file.base64) {
                    viewerContent.innerHTML = `<iframe src="${file.base64}" style="width: 100%; height: 70vh; border: none; border-radius: 10px;"></iframe>`;
                }
            } else {
                viewerContent.innerHTML = `<p style="color: white; text-align: center;">${currentLanguage === 'fr' ? 'Prévisualisation non disponible' : 'المعاينة غير متاحة'}</p>`;
            }
            
            // Afficher le visualiseur
            viewer.classList.add('active');
        }

        function closeFileViewer() {
            document.getElementById('fileViewer').classList.remove('active');
        }

        // ==================== GESTION DES TEXTES ====================
        function viewText(index) {
            const texts = JSON.parse(localStorage.getItem('ansfal_text') || '[]');
            const text = texts[index];
            
            if (!text) {
                showAlert(currentLanguage === 'fr' ? 'Texte non trouvé' : 'النص غير موجود', 'error');
                return;
            }
            
            // Créer une modal pour afficher le texte
            const modalHTML = `
                <div class="modal-overlay" id="textViewModal" style="display: flex;">
                    <div class="modal">
                        <div class="modal-header">
                            <h3 class="modal-title">
                                <i class="fas fa-file-alt"></i> ${text.title || (currentLanguage === 'fr' ? 'Texte sans titre' : 'نص بدون عنوان')}
                            </h3>
                            <button class="close-modal" onclick="closeModal('textViewModal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div style="background: #f5f5f5; padding: 20px; border-radius: 10px; max-height: 500px; overflow-y: auto;">
                                <pre style="white-space: pre-wrap; font-family: inherit; margin: 0;">${text.content}</pre>
                            </div>
                            <div style="margin-top: 15px; color: #666; font-size: 0.9rem;">
                                <i class="far fa-calendar"></i> ${new Date(text.date).toLocaleDateString(currentLanguage === 'fr' ? 'fr-FR' : 'ar-MA')}
                            </div>
                            <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 30px;">
                                <button class="btn-browse" onclick="closeModal('textViewModal')" style="background: var(--danger);">
                                    <i class="fas fa-times"></i> ${currentLanguage === 'fr' ? 'Fermer' : 'إغلاق'}
                                </button>
                                <button class="btn-browse" onclick="editText(${index})" style="background: var(--info);">
                                    <i class="fas fa-edit"></i> ${currentLanguage === 'fr' ? 'Modifier' : 'تعديل'}
                                </button>
                                <button class="btn-browse" onclick="deleteText(${index})" style="background: var(--danger);">
                                    <i class="fas fa-trash"></i> ${currentLanguage === 'fr' ? 'Supprimer' : 'حذف'}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.remove();
            }
        }

        function deleteText(index) {
            const confirmationMessage = currentLanguage === 'fr' 
                ? 'Voulez-vous vraiment supprimer ce texte ?' 
                : 'هل تريد حقاً حذف هذا النص؟';
            
            if (!confirm(confirmationMessage)) return;
            
            const texts = JSON.parse(localStorage.getItem('ansfal_text') || '[]');
            
            if (index >= 0 && index < texts.length) {
                texts.splice(index, 1);
                localStorage.setItem('ansfal_text', JSON.stringify(texts));
                
                showAlert(
                    currentLanguage === 'fr' ? 'Texte supprimé avec succès' : 'تم حذف النص بنجاح', 
                    'success'
                );
                
                // Fermer la modale si elle est ouverte
                closeModal('textViewModal');
                
                // Recharger la section texte
                loadTextDashboard();
                
                // Mettre à jour les aperçus
                updatePreview();
            }
        }

        function editText(index) {
            const texts = JSON.parse(localStorage.getItem('ansfal_text') || '[]');
            const text = texts[index];
            
            if (!text) return;
            
            // Fermer la modale de visualisation si elle est ouverte
            closeModal('textViewModal');
            
            // Ouvrir la modale de texte avec les données existantes
            showTextModal(text, index);
        }

        function showTextModal(textData = null, index = null) {
            const t = translations[currentLanguage];
            
            const modalHTML = `
                <div class="modal-overlay" id="textModal" style="display: flex;">
                    <div class="modal">
                        <div class="modal-header">
                            <h3 class="modal-title">
                                <i class="fas fa-file-alt"></i> ${textData ? t.editText : t.addText}
                            </h3>
                            <button class="close-modal" onclick="closeModal('textModal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div style="margin-bottom: 25px;">
                                <label style="display: block; margin-bottom: 10px; font-weight: 500; color: var(--dark);">
                                    <i class="fas fa-heading"></i> ${t.textTitle}
                                </label>
                                <input type="text" id="textTitleInput" 
                                    value="${textData ? textData.title : ''}" 
                                    placeholder="${currentLanguage === 'fr' ? 'Exemple: Rapport annuel 2024' : 'مثال: التقرير السنوي 2024'}" 
                                    style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 1.1rem;">
                            </div>

                            <div style="margin-bottom: 25px;">
                                <label style="display: block; margin-bottom: 10px; font-weight: 500; color: var(--dark);">
                                    <i class="fas fa-align-left"></i> ${t.textContent}
                                </label>
                                <textarea id="textContentInput" 
                                    placeholder="${currentLanguage === 'fr' ? 'Écrivez votre contenu ici...' : 'اكتب محتواك هنا...'}" 
                                    style="width: 100%; height: 300px; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 1rem; resize: vertical;">${textData ? textData.content : ''}</textarea>
                            </div>

                            <div style="display: flex; gap: 15px; justify-content: flex-end;">
                                <button class="btn-browse" onclick="closeModal('textModal')" style="background: var(--danger);">
                                    <i class="fas fa-times"></i> ${t.cancel}
                                </button>
                                <button class="btn-browse" onclick="saveTextContent(${index !== null ? index : 'null'})" style="background: var(--success);">
                                    <i class="fas fa-save"></i> ${t.save}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        function saveTextContent(index = null) {
            const title = document.getElementById('textTitleInput').value.trim();
            const content = document.getElementById('textContentInput').value.trim();
            
            if (!title || !content) {
                showAlert(translations[currentLanguage].textRequired, 'error');
                return;
            }
            
            const texts = JSON.parse(localStorage.getItem('ansfal_text') || '[]');
            const textData = {
                title: title,
                content: content,
                date: new Date().toISOString()
            };
            
            if (index !== null && index >= 0 && index < texts.length) {
                // Édition d'un texte existant
                texts[index] = textData;
            } else {
                // Ajout d'un nouveau texte
                texts.push(textData);
            }
            
            localStorage.setItem('ansfal_text', JSON.stringify(texts));
            
            showAlert(translations[currentLanguage].textSaved, 'success');
            closeModal('textModal');
            
            // Recharger la section texte
            loadTextDashboard();
            
            // Mettre à jour les aperçus
            updatePreview();
        }

        // ==================== GESTION DES UTILISATEURS (TRADUITE EN FRANÇAIS) ====================
        function showAddUserModal(userData = null) {
            if (!currentUser || currentUser.role !== 'admin') {
                showAlert(
                    currentLanguage === 'fr' 
                        ? 'Seuls les administrateurs peuvent gérer les utilisateurs' 
                        : 'فقط المديرون يمكنهم إدارة المستخدمين', 
                    'error'
                );
                return;
            }
            
            const t = translations[currentLanguage];
            const isEdit = userData !== null;
            
            const modalHTML = `
                <div class="modal-overlay" id="userModal" style="display: flex;">
                    <div class="modal">
                        <div class="modal-header">
                            <h3 class="modal-title">
                                <i class="fas fa-${isEdit ? 'user-edit' : 'user-plus'}"></i> ${isEdit ? t.editUser : t.addUser}
                            </h3>
                            <button class="close-modal" onclick="closeModal('userModal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--dark);">
                                    <i class="fas fa-user"></i> ${t.username}
                                </label>
                                <input type="text" id="userUsername" 
                                    value="${userData ? userData.username : ''}" 
                                    placeholder="${currentLanguage === 'fr' ? 'Exemple: admin' : 'مثال: admin'}" 
                                    style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;"
                                    ${isEdit ? 'readonly' : ''}>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--dark);">
                                    <i class="fas fa-lock"></i> ${t.password}${isEdit ? ` (${currentLanguage === 'fr' ? 'laisser vide pour ne pas changer' : 'اترك فارغاً للحفاظ على نفس كلمة المرور'})` : ''}
                                </label>
                                <input type="password" id="userPassword" 
                                    placeholder="${isEdit ? (currentLanguage === 'fr' ? 'Nouveau mot de passe' : 'كلمة مرور جديدة') : t.password}" 
                                    style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                            </div>

                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--dark);">
                                    <i class="fas fa-id-card"></i> ${currentLanguage === 'fr' ? 'Nom complet' : 'الاسم الكامل'}
                                </label>
                                <input type="text" id="userName" 
                                    value="${userData ? userData.name : ''}" 
                                    placeholder="${currentLanguage === 'fr' ? 'Exemple: Administrateur' : 'مثال: المدير العام'}" 
                                    style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                            </div>

                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--dark);">
                                    <i class="fas fa-envelope"></i> ${currentLanguage === 'fr' ? 'Email' : 'البريد الإلكتروني'}
                                </label>
                                <input type="email" id="userEmail" 
                                    value="${userData ? userData.email : ''}" 
                                    placeholder="admin@ansfal.org" 
                                    style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                            </div>

                            <div style="margin-bottom: 25px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--dark);">
                                    <i class="fas fa-user-tag"></i> ${currentLanguage === 'fr' ? 'Rôle' : 'الدور'}
                                </label>
                                <select id="userRole" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                                    <option value="admin" ${userData && userData.role === 'admin' ? 'selected' : ''}>${t.admin}</option>
                                    <option value="webmaster" ${userData && userData.role === 'webmaster' ? 'selected' : ''}>${t.webmaster}</option>
                                    <option value="editor" ${userData && userData.role === 'editor' ? 'selected' : ''}>${t.editor}</option>
                                </select>
                            </div>

                            <div style="display: flex; gap: 15px; justify-content: flex-end;">
                                <button class="btn-browse" onclick="closeModal('userModal')" style="background: var(--danger);">
                                    <i class="fas fa-times"></i> ${t.cancel}
                                </button>
                                <button class="btn-browse" onclick="saveUserAction('${userData ? userData.id : ''}')" style="background: var(--success);">
                                    <i class="fas fa-save"></i> ${t.save}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        function saveUserAction(userId = '') {
            const username = document.getElementById('userUsername').value.trim();
            const password = document.getElementById('userPassword').value;
            const name = document.getElementById('userName').value.trim();
            const email = document.getElementById('userEmail').value.trim();
            const role = document.getElementById('userRole').value;
            
            if (!username || !name || !email) {
                showAlert(currentLanguage === 'fr' ? 'Veuillez remplir tous les champs obligatoires' : 'يرجى ملء جميع الحقول الإلزامية', 'error');
                return;
            }
            
            // Pour un nouvel utilisateur, vérifier que le mot de passe est fourni
            if (!userId && !password) {
                showAlert(currentLanguage === 'fr' ? 'Le mot de passe est obligatoire pour un nouvel utilisateur' : 'كلمة المرور إلزامية للمستخدم الجديد', 'error');
                return;
            }
            
            const users = loadUsers();
            
            if (userId) {
                // Édition d'un utilisateur existant
                const userIndex = users.findIndex(u => u.id === userId);
                if (userIndex !== -1) {
                    users[userIndex].name = name;
                    users[userIndex].email = email;
                    users[userIndex].role = role;
                    
                    // Mettre à jour le mot de passe seulement si fourni
                    if (password) {
                        users[userIndex].password = password;
                    }
                }
            } else {
                // Vérifier si l'utilisateur existe déjà
                if (users.some(u => u.username === username)) {
                    showAlert(currentLanguage === 'fr' ? 'Ce nom d\'utilisateur existe déjà' : 'اسم المستخدم هذا موجود بالفعل', 'error');
                    return;
                }
                
                // Ajout d'un nouvel utilisateur
                const newUser = {
                    id: 'user_' + Date.now(),
                    username: username,
                    password: password,
                    name: name,
                    email: email,
                    role: role,
                    createdAt: new Date().toISOString()
                };
                
                users.push(newUser);
            }
            
            localStorage.setItem('ansfal_users', JSON.stringify(users));
            
            showAlert(
                currentLanguage === 'fr' 
                    ? 'Utilisateur ajouté avec succès' 
                    : 'تم إضافة المستخدم بنجاح', 
                'success'
            );
            
            closeModal('userModal');
            loadUsersSection();
        }

        function saveUser() {
            const username = document.getElementById('userUsername').value.trim();
            const password = document.getElementById('userPassword').value.trim();
            const name = document.getElementById('userName').value.trim();
            const email = document.getElementById('userEmail').value.trim();
            const role = document.getElementById('userRole').value;
            
            if (!username || !password || !name || !email) {
                showAlert(
                    currentLanguage === 'fr' 
                        ? 'Veuillez remplir tous les champs' 
                        : 'يرجى ملء جميع الحقول', 
                    'error'
                );
                return;
            }
            
            const users = loadUsers();
            
            // Vérifier si l'utilisateur existe déjà
            if (users.some(u => u.username === username)) {
                showAlert(
                    currentLanguage === 'fr' 
                        ? 'Ce nom d\'utilisateur existe déjà' 
                        : 'اسم المستخدم هذا موجود بالفعل', 
                    'error'
                );
                return;
            }
            
            // Ajouter le nouvel utilisateur
            const newUser = {
                id: 'user_' + Date.now(),
                username: username,
                password: password,
                name: name,
                email: email,
                role: role,
                createdAt: new Date().toISOString()
            };
            
            users.push(newUser);
            localStorage.setItem('ansfal_users', JSON.stringify(users));
            
            showAlert(
                currentLanguage === 'fr' 
                    ? 'Utilisateur ajouté avec succès' 
                    : 'تم إضافة المستخدم بنجاح', 
                'success'
            );
            
            hideUserModal();
            loadUsersSection();
        }

        function editUser(userId) {
            const users = loadUsers();
            const user = users.find(u => u.id === userId);
            
            if (user) {
                showAddUserModal(user);
            }
        }

        function hideUserModal() {
            document.getElementById('userModal').classList.remove('active');
        }

        function hideTextModal() {
            document.getElementById('textModal').classList.remove('active');
        }

        function hidePasswordModal() {
            document.getElementById('passwordModal').classList.remove('active');
        }

        function hideLogoModal() {
            document.getElementById('logoModal').classList.remove('active');
        }

        function hideImportModal() {
            document.getElementById('importModal').classList.remove('active');
        }

        // ==================== PRÉVISUALISATIONS ====================
        function updatePreview() {
            // Mettre à jour les aperçus dans le dashboard simplifié
            updateSectionPreview('image', 'galleryPreview', 'galleryEmpty');
            updateSectionPreview('video', 'videosPreview', 'videosEmpty');
            updateSectionPreview('pdf', 'documentsPreview', 'documentsEmpty');
            updateTextPreview();
            
            // Mettre à jour les statistiques
            updateStats();
        }

        function updateSectionPreview(type, previewId, emptyId) {
            const items = JSON.parse(localStorage.getItem(`ansfal_${type}`) || '[]');
            const preview = document.getElementById(previewId);
            const empty = document.getElementById(emptyId);
            
            if (!preview || !empty) return;
            
            if (items.length === 0) {
                preview.innerHTML = '';
                empty.style.display = 'block';
                return;
            }
            
            empty.style.display = 'none';
            let previewHTML = '';
            
            // Afficher les 3 derniers éléments
            const recentItems = items.slice(-3).reverse();
            
            recentItems.forEach(item => {
                let icon = 'fas fa-file';
                if (type === 'image') icon = 'fas fa-image';
                else if (type === 'video') icon = 'fas fa-video';
                else if (type === 'pdf') icon = 'fas fa-file-pdf';
                
                previewHTML += `
                    <div class="preview-item" onclick="viewFile('${type}', ${items.indexOf(item)})">
                        <i class="${icon}"></i>
                        <span>${item.name || item.title || 'Fichier'}</span>
                    </div>
                `;
            });
            
            preview.innerHTML = previewHTML;
        }

        function updateTextPreview() {
            const texts = JSON.parse(localStorage.getItem('ansfal_text') || '[]');
            const preview = document.getElementById('textPreview');
            const empty = document.getElementById('textEmpty');
            
            if (!preview || !empty) return;
            
            if (texts.length === 0) {
                preview.innerHTML = '';
                empty.style.display = 'block';
                return;
            }
            
            empty.style.display = 'none';
            let previewHTML = '';
            
            // Afficher les 3 derniers textes
            const recentTexts = texts.slice(-3).reverse();
            
            recentTexts.forEach((text, index) => {
                previewHTML += `
                    <div class="preview-item" onclick="viewText(${texts.indexOf(text)})">
                        <i class="fas fa-file-alt"></i>
                        <span>${text.title || 'Texte sans titre'}</span>
                    </div>
                `;
            });
            
            preview.innerHTML = previewHTML;
        }

        function updateStats() {
            // Mettre à jour les statistiques
            const images = JSON.parse(localStorage.getItem('ansfal_image') || '[]');
            const videos = JSON.parse(localStorage.getItem('ansfal_video') || '[]');
            const pdfs = JSON.parse(localStorage.getItem('ansfal_pdf') || '[]');
            const texts = JSON.parse(localStorage.getItem('ansfal_text') || '[]');
            const users = loadUsers();
            
            const totalMedia = images.length + videos.length + pdfs.length + texts.length;
            
            document.getElementById('totalMediaStat').textContent = totalMedia;
            document.getElementById('totalUsersStat').textContent = users.length;
        }

        function updateStorageUsage() {
            let totalSize = 0;
            
            // Calculer la taille totale des données
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('ansfal_')) {
                    const value = localStorage.getItem(key);
                    totalSize += value.length * 2; // Approximation en bytes (UTF-16)
                }
            }
            
            const maxSize = 5 * 1024 * 1024; // 5MB limite pour localStorage
            const percentage = (totalSize / maxSize) * 100;
            
            document.getElementById('storageUsage').style.width = `${percentage}%`;
            document.getElementById('storageText').textContent = 
                `${currentLanguage === 'fr' ? 'Utilisé:' : 'مستخدم:'} ${formatFileSize(totalSize)} / ${formatFileSize(maxSize)} (${Math.round(percentage)}%)`;
        }

        // ==================== AUTRES FONCTIONS NÉCESSAIRES ====================
        function showPasswordModal() {
            const t = translations[currentLanguage];
            
            const modalHTML = `
                <div class="modal-overlay" id="passwordModal" style="display: flex;">
                    <div class="modal">
                        <div class="modal-header">
                            <h3 class="modal-title">
                                <i class="fas fa-key"></i> ${t.changePassword}
                            </h3>
                            <button class="close-modal" onclick="closeModal('passwordModal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--dark);">
                                    <i class="fas fa-lock"></i> ${currentLanguage === 'fr' ? 'Mot de passe actuel' : 'كلمة المرور الحالية'}
                                </label>
                                <input type="password" id="currentPassword" 
                                    placeholder="${currentLanguage === 'fr' ? 'Votre mot de passe actuel' : 'كلمة المرور الحالية'}" 
                                    style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                            </div>

                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--dark);">
                                    <i class="fas fa-lock"></i> ${currentLanguage === 'fr' ? 'Nouveau mot de passe' : 'كلمة المرور الجديدة'}
                                </label>
                                <input type="password" id="newPassword" 
                                    placeholder="${currentLanguage === 'fr' ? 'Nouveau mot de passe' : 'كلمة المرور الجديدة'}" 
                                    style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                            </div>

                            <div style="margin-bottom: 25px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--dark);">
                                    <i class="fas fa-lock"></i> ${currentLanguage === 'fr' ? 'Confirmer le nouveau mot de passe' : 'تأكيد كلمة المرور الجديدة'}
                                </label>
                                <input type="password" id="confirmPassword" 
                                    placeholder="${currentLanguage === 'fr' ? 'Confirmez le nouveau mot de passe' : 'تأكيد كلمة المرور الجديدة'}" 
                                    style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                            </div>

                            <div style="display: flex; gap: 15px; justify-content: flex-end;">
                                <button class="btn-browse" onclick="closeModal('passwordModal')" style="background: var(--danger);">
                                    <i class="fas fa-times"></i> ${t.cancel}
                                </button>
                                <button class="btn-browse" onclick="changePasswordAction()" style="background: var(--success);">
                                    <i class="fas fa-save"></i> ${t.save}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        function changePasswordAction() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // Vérifier que le mot de passe actuel est correct
            if (currentUser && currentUser.username === 'admin') {
                // Pour l'admin par défaut, vérifier le mot de passe actuel
                if (currentPassword !== '123456') {
                    showAlert(translations[currentLanguage].currentPasswordWrong, 'error');
                    return;
                }
            } else {
                // Pour les autres utilisateurs, vous devrez implémenter la vérification
                showAlert(currentLanguage === 'fr' ? 'Fonctionnalité en développement' : 'الميزة قيد التطوير', 'info');
                return;
            }
            
            // Vérifier que les nouveaux mots de passe correspondent
            if (newPassword !== confirmPassword) {
                showAlert(translations[currentLanguage].passwordMismatch, 'error');
                return;
            }
            
            // Vérifier la longueur du mot de passe
            if (newPassword.length < 6) {
                showAlert(currentLanguage === 'fr' ? 'Le mot de passe doit contenir au moins 6 caractères' : 'يجب أن تحتوي كلمة المرور على 6 أحرف على الأقل', 'error');
                return;
            }
            
            // Mettre à jour le mot de passe
            const users = loadUsers();
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            
            if (userIndex !== -1) {
                users[userIndex].password = newPassword;
                localStorage.setItem('ansfal_users', JSON.stringify(users));
                
                // Mettre à jour l'utilisateur courant
                currentUser.password = newPassword;
                
                showAlert(translations[currentLanguage].passwordChanged, 'success');
                closeModal('passwordModal');
                
                // Si c'était la première connexion, réinitialiser le flag
                if (isFirstLogin) {
                    isFirstLogin = false;
                }
            }
        }

        function changePassword() {
            // Alias pour changePasswordAction
            changePasswordAction();
        }

        // ==================== FONCTIONS D'IMPORT/EXPORT ====================
        function showImportModal() {
            const t = translations[currentLanguage];
            
            const modalHTML = `
                <div class="modal-overlay" id="importModal" style="display: flex;">
                    <div class="modal">
                        <div class="modal-header">
                            <h3 class="modal-title">
                                <i class="fas fa-file-import"></i> ${t.importContent}
                            </h3>
                            <button class="close-modal" onclick="closeModal('importModal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <h4 style="color: var(--dark); margin-bottom: 20px; font-size: 1.3rem;">
                                <i class="fas fa-info-circle"></i> ${t.howToImport}
                            </h4>
                            
                            <div class="import-options">
                                <div class="import-option" onclick="importFromFile()">
                                    <div class="import-icon">
                                        <i class="fas fa-file-import"></i>
                                    </div>
                                    <h5 class="import-title">${t.jsonFile}</h5>
                                    <p class="import-desc">${t.importJsonDesc}</p>
                                    <input type="file" id="jsonFileInput" class="json-input" accept=".json">
                                </div>

                                <div class="import-option" onclick="importFromText()">
                                    <div class="import-icon">
                                        <i class="fas fa-paste"></i>
                                    </div>
                                    <h5 class="import-title">${t.pasteJson}</h5>
                                    <p class="import-desc">${t.pasteJsonDesc}</p>
                                </div>

                                <div class="import-option" onclick="importSample()">
                                    <div class="import-icon">
                                        <i class="fas fa-magic"></i>
                                    </div>
                                    <h5 class="import-title">${t.sample}</h5>
                                    <p class="import-desc">${t.sampleDesc}</p>
                                </div>
                            </div>

                            <div id="pasteArea" style="display: none; margin-top: 30px;">
                                <h4 style="color: var(--dark); margin-bottom: 15px;">
                                    <i class="fas fa-paste"></i> ${t.pasteHere}
                                </h4>
                                <textarea id="jsonTextarea" style="width: 100%; height: 200px; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-family: monospace; resize: vertical;"></textarea>
                                <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 20px;">
                                    <button class="btn-browse" onclick="hidePasteArea()" style="background: var(--danger);">
                                        <i class="fas fa-times"></i> ${t.cancel}
                                    </button>
                                    <button class="btn-browse" onclick="processPastedJSON()" style="background: var(--success);">
                                        <i class="fas fa-check"></i> ${t.import}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        function importFromFile() {
            document.getElementById('jsonFileInput').click();
            document.getElementById('jsonFileInput').onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        importData(data);
                    } catch (error) {
                        showAlert(currentLanguage === 'fr' ? 'Fichier JSON invalide' : 'ملف JSON غير صالح', 'error');
                    }
                };
                reader.readAsText(file);
            };
        }

        function importFromText() {
            document.getElementById('pasteArea').style.display = 'block';
        }

        function hidePasteArea() {
            document.getElementById('pasteArea').style.display = 'none';
        }

        function processPastedJSON() {
            const jsonText = document.getElementById('jsonTextarea').value.trim();
            
            if (!jsonText) {
                showAlert(currentLanguage === 'fr' ? 'Veuillez coller du JSON valide' : 'يرجى لصق JSON صالح', 'error');
                return;
            }
            
            try {
                const data = JSON.parse(jsonText);
                importData(data);
            } catch (error) {
                showAlert(currentLanguage === 'fr' ? 'JSON invalide' : 'JSON غير صالح', 'error');
            }
        }

        function importSample() {
            const sampleData = {
                images: [
                    {
                        id: Date.now(),
                        name: "Exemple d'image",
                        type: "image",
                        base64: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMWFhZGYyIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIyNCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkVYRU1QTEU8L3RleHQ+PC9zdmc+",
                        extension: "svg",
                        date: new Date().toISOString()
                    }
                ],
                texts: [
                    {
                        title: currentLanguage === 'fr' ? "Exemple de texte" : "مثال على نص",
                        content: currentLanguage === 'fr' ? "Ceci est un exemple de texte importé. Vous pouvez le modifier ou le supprimer." : "هذا مثال على نص مستورد. يمكنك تعديله أو حذفه.",
                        date: new Date().toISOString()
                    }
                ]
            };
            
            importData(sampleData);
        }

        function importData(data) {
            const confirmationMessage = currentLanguage === 'fr' 
                ? 'Voulez-vous remplacer vos données actuelles ?' 
                : 'هل تريد استبدال بياناتك الحالية؟';
            
            if (!confirm(confirmationMessage)) return;
            
            let importedCount = 0;
            
            // Importer les images
            if (data.images && Array.isArray(data.images)) {
                localStorage.setItem('ansfal_image', JSON.stringify(data.images));
                importedCount += data.images.length;
            }
            
            // Importer les vidéos
            if (data.videos && Array.isArray(data.videos)) {
                localStorage.setItem('ansfal_video', JSON.stringify(data.videos));
                importedCount += data.videos.length;
            }
            
            // Importer les PDFs
            if (data.pdfs && Array.isArray(data.pdfs)) {
                localStorage.setItem('ansfal_pdf', JSON.stringify(data.pdfs));
                importedCount += data.pdfs.length;
            }
            
            // Importer les textes
            if (data.texts && Array.isArray(data.texts)) {
                localStorage.setItem('ansfal_text', JSON.stringify(data.texts));
                importedCount += data.texts.length;
            }
            
            // Importer les utilisateurs (avec prudence)
            if (data.users && Array.isArray(data.users) && currentUser && currentUser.role === 'admin') {
                localStorage.setItem('ansfal_users', JSON.stringify(data.users));
                importedCount += data.users.length;
            }
            
            showAlert(
                `${importedCount} ${translations[currentLanguage].importSuccess}`,
                'success'
            );
            
            closeModal('importModal');
            
            // Recharger toutes les sections
            loadGalleryDashboard();
            loadVideosDashboard();
            loadDocumentsDashboard();
            loadTextDashboard();
            loadUsersSection();
            loadPublicGallery();
            loadPublicVideos();
            updatePreview();
        }

        function exportToJSON() {
            const data = {
                images: JSON.parse(localStorage.getItem('ansfal_image') || '[]'),
                videos: JSON.parse(localStorage.getItem('ansfal_video') || '[]'),
                pdfs: JSON.parse(localStorage.getItem('ansfal_pdf') || '[]'),
                texts: JSON.parse(localStorage.getItem('ansfal_text') || '[]'),
                users: currentUser && currentUser.role === 'admin' ? JSON.parse(localStorage.getItem('ansfal_users') || '[]') : [],
                exportDate: new Date().toISOString(),
                exportLanguage: currentLanguage
            };
            
            const jsonString = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `ansfal-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showAlert(translations[currentLanguage].exportSuccess, 'success');
        }

        function exportSection(section) {
            const data = JSON.parse(localStorage.getItem(`ansfal_${section}`) || '[]');
            
            if (data.length === 0) {
                showAlert(currentLanguage === 'fr' ? 'Aucune donnée à exporter' : 'لا توجد بيانات للتصدير', 'info');
                return;
            }
            
            const exportData = {
                [section + 's']: data,
                exportDate: new Date().toISOString(),
                exportLanguage: currentLanguage
            };
            
            const jsonString = JSON.stringify(exportData, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `ansfal-${section}-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showAlert(currentLanguage === 'fr' ? 'Section exportée avec succès' : 'تم تصدير القسم بنجاح', 'success');
        }

        function resetAllData() {
            const confirmationMessage = currentLanguage === 'fr' 
                ? 'Voulez-vous vraiment supprimer TOUTES les données ? Cette action est irréversible.' 
                : 'هل تريد حقاً حذف جميع البيانات؟ هذا الإجراء لا يمكن التراجع عنه.';
            
            if (!confirm(confirmationMessage)) return;
            
            // Supprimer toutes les données de l'association
            const keysToRemove = [
                'ansfal_image',
                'ansfal_video',
                'ansfal_pdf',
                'ansfal_text',
                'ansfal_logo'
            ];
            
            keysToRemove.forEach(key => {
                localStorage.removeItem(key);
            });
            
            // Ne pas supprimer les utilisateurs et les paramètres
            showAlert(translations[currentLanguage].allDataCleared, 'success');
            
            // Recharger toutes les sections
            loadGalleryDashboard();
            loadVideosDashboard();
            loadDocumentsDashboard();
            loadTextDashboard();
            loadPublicGallery();
            loadPublicVideos();
            updatePreview();
        }

        function exportUsers() {
            if (!currentUser || currentUser.role !== 'admin') {
                showAlert(
                    currentLanguage === 'fr' 
                        ? 'Seuls les administrateurs peuvent exporter les utilisateurs' 
                        : 'فقط المديرون يمكنهم تصدير المستخدمين', 
                    'error'
                );
                return;
            }
            
            const users = loadUsers();
            
            if (users.length === 0) {
                showAlert(currentLanguage === 'fr' ? 'Aucun utilisateur à exporter' : 'لا توجد مستخدمين للتصدير', 'info');
                return;
            }
            
            const exportData = {
                users: users,
                exportDate: new Date().toISOString(),
                exportLanguage: currentLanguage
            };
            
            const jsonString = JSON.stringify(exportData, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `ansfal-users-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showAlert(currentLanguage === 'fr' ? 'Utilisateurs exportés avec succès' : 'تم تصدير المستخدمين بنجاح', 'success');
        }
    </script>
</body>
</html>
